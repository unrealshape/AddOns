local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.CastPooling;local q=l.CastAnnotated;local r=l.CastSuggested;local s=l.Commons.Evoker;local t=l.Commons.Everyone.num;local u=l.Commons.Everyone.bool;local v=math.max;local w=math.min;local x=j.Evoker.Augmentation;local y=k.Evoker.Augmentation;local z={y.AshesoftheEmbersoul:ID(),y.BalefireBranch:ID(),y.BeacontotheBeyond:ID(),y.BelorrelostheSuncaller:ID(),y.IrideusFragment:ID(),y.MirrorofFracturedTomorrows:ID(),y.NymuesUnravelingSpindle:ID(),y.SpoilsofNeltharus:ID()}local A=g:GetEquipment()local B=A[13]and k(A[13])or k(0)local C=A[14]and k(A[14])or k(0)local D=l.Commons.Everyone;local E={General=l.GUISettings.General,Commons=l.GUISettings.APL.Evoker.Commons,Augmentation=l.GUISettings.APL.Evoker.Augmentation}local F={}local G=x.FontofMagic:IsAvailable()and 4 or 3;local H=x.FontofMagic:IsAvailable()and 0.8 or 1;local I=11111;local J=11111;local K=g:GCD()+0.25;local L=2;local M,N;local O,P;local Q=true;local R=E.Augmentation.MinOpenerDelay;local S=0;local T=false;local U={{x.TailSwipe,"Cast Tail Swipe (Interrupt)",function()return true end},{x.WingBuffet,"Cast Wing Buffet (Interrupt)",function()return true end}}d:RegisterForEvent(function()I=11111;J=11111 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()A=g:GetEquipment()B=A[13]and k(A[13])or k(0)C=A[14]and k(A[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()G=x.FontofMagic:IsAvailable()and 4 or 3;H=x.FontofMagic:IsAvailable()and 0.8 or 1 end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")local function V()end;local function W()local X;if UnitInRaid("player")then X=f.Raid elseif UnitInParty("player")then X=f.Party else return false end;local Y=nil;for Z,_ in pairs(X)do if _:Exists()and _:BuffUp(x.SourceofMagicBuff)then Y=_ end end;if Y==nil then return true end;return false end;local function a0()local X;if UnitInRaid("player")then X=f.Raid elseif UnitInParty("player")then X=f.Party else X=g end;if X==g then return g:BuffStack(x.BlisteringScalesBuff)else for a1,_ in pairs(X)do if _:Exists()and(_:IsTankingAoE(8)or _:IsTanking(h))and UnitGroupRolesAssigned(a1)=="TANK"then return _:BuffStack(x.BlisteringScalesBuff)end end end;return 0 end;local function a2(a3)local a4=0;for Z,a5 in pairs(a3)do local a6=a5:DebuffRemains(x.TemporalWoundDebuff)a4=v(a6,a4)end;return a4 end;local function a7()return x.EbonMightSelfBuff:BaseDuration()*(1+g:CritChancePct()/100)end;local function a8()local X;local a9=0;if UnitInRaid("player")then X=f.Raid elseif UnitInParty("player")then X=f.Party else return 0 end;for Z,a5 in pairs(X)do if a5:Exists()then a9=a9+1 end end;return a9 end;local function aa()Q=true;R=E.Augmentation.MinOpenerDelay;if not x.InterwovenThreads:IsAvailable()then S=R else S=R+(S or 0)end;T=false;local ab=B:ID()M=ab==y.IrideusFragment:ID()or ab==y.BalefireBranch:ID()or ab==y.AshesoftheEmbersoul:ID()or ab==y.NymuesUnravelingSpindle:ID()or ab==y.MirrorofFracturedTomorrows:ID()or ab==y.SpoilsofNeltharus:ID()local ac=C:ID()N=ac==y.IrideusFragment:ID()or ac==y.BalefireBranch:ID()or ac==y.AshesoftheEmbersoul:ID()or ac==y.NymuesUnravelingSpindle:ID()or ac==y.MirrorofFracturedTomorrows:ID()or ac==y.SpoilsofNeltharus:ID()O=M or ab==y.BeacontotheBeyond:ID()or ab==y.BelorrelostheSuncaller:ID()P=N or ac==y.BeacontotheBeyond:ID()or ac==y.BelorrelostheSuncaller:ID()if x.BlessingoftheBronze:IsCastable()and D.GroupBuffMissing(x.BlessingoftheBronzeBuff)then if o(x.BlessingoftheBronze,E.Commons.GCDasOffGCD.BlessingOfTheBronze)then return"blessing_of_the_bronze precombat"end end;if x.SourceofMagic:IsCastable()and W()then if o(x.SourceofMagic)then return"source_of_magic precombat"end end;if x.BlackAttunement:IsCastable()and g:BuffDown(x.BlackAttunementBuff)then if o(x.BlackAttunement)then return"black_attunement precombat"end end;if x.BronzeAttunement:IsCastable()and(g:BuffDown(x.BronzeAttunementBuff)and g:BuffUp(x.BlackAttunementBuff)and not g:BuffUp(x.BlackAttunementBuff,false))then if o(x.BronzeAttunement)then return"bronze_attunement precombat"end end;if x.BlisteringScales:IsCastable()and a0()<10 then if o(x.BlisteringScales,nil,E.Augmentation.DisplayStyle.AugBuffs)then return"blistering_scales precombat 2"end end;if x.LivingFlame:IsCastable()then if o(x.LivingFlame,nil,nil,not h:IsSpellInRange(x.LivingFlame))then return"living_flame precombat 10"end end end;local function ad()if x.EbonMight:IsReady()then if o(x.EbonMight,E.Augmentation.GCDasOffGCD.EbonMight)then return"ebon_might ebon_logic 2"end end end;local function ae()if not T then S=w(S,R)end;S=S-1;if not T then T=true end;if y.NymuesUnravelingSpindle:IsEquippedAndReady()then S=S-2 end;if E.Commons.Enabled.Trinkets and y.NymuesUnravelingSpindle:IsEquippedAndReady()and x.BreathofEons:CooldownRemains()<=3 then if o(y.NymuesUnravelingSpindle,nil,E.Commons.DisplayStyle.Trinkets,not h:IsInRange(45))then return"nymues_unraveling_spindle opener_filler 2"end end;if x.LivingFlame:IsReady()and(EnemiesCount8ySplash==1 or x.PupilofAlexstrasza:IsAvailable())then if o(x.LivingFlame,nil,nil,not h:IsSpellInRange(x.LivingFlame))then return"living_flame opener_filler 4"end end;if x.AzureStrike:IsCastable()then if o(x.AzureStrike,nil,nil,not h:IsSpellInRange(x.AzureStrike))then return"azure_strike opener_filler 6"end end end;local function af()if E.Commons.Enabled.Trinkets then if y.NymuesUnravelingSpindle:IsEquippedAndReady()and x.BreathofEons:CooldownRemains()<=3 then if o(y.NymuesUnravelingSpindle,nil,E.Commons.DisplayStyle.Trinkets,not h:IsInRange(45))then return"nymues_unraveling_spindle items 2"end end;if h:DebuffUp(x.TemporalWoundDebuff)or J<=30 and g:BuffUp(x.EbonMightSelfBuff)then if y.IrideusFragment:IsEquippedAndReady()then if o(y.IrideusFragment,nil,E.Commons.DisplayStyle.Trinkets)then return"irideus_fragment items 4"end end;if y.AshesoftheEmbersoul:IsEquippedAndReady()then if o(y.AshesoftheEmbersoul,nil,E.Commons.DisplayStyle.Trinkets)then return"ashes_of_the_embersoul items 6"end end;if y.MirrorofFracturedTomorrows:IsEquippedAndReady()then if o(y.MirrorofFracturedTomorrows,nil,E.Commons.DisplayStyle.Trinkets)then return"mirror_of_fractured_tomorrows items 8"end end;if y.BalefireBranch:IsEquippedAndReady()then if o(y.BalefireBranch,nil,E.Commons.DisplayStyle.Trinkets)then return"balefire_branch items 10"end end end;if y.SpoilsofNeltharus:IsEquippedAndReady()and(g:BuffUp(x.SpoilsofNeltharusMastery)and(not((B:ID()==y.IrideusFragment:ID()or B:ID()==y.MirrorofFracturedTomorrows:ID())and B:CooldownUp()or(C:ID()==y.IrideusFragment:ID()or C:ID()==y.MirrorofFracturedTomorrows:ID())and C:CooldownUp())or not(d.CombatTime()%120<=20 or J>=190 and J<=250 and d.CombatTime()%60<=25 or J<=25)))then if o(y.SpoilsofNeltharus,nil,E.Commons.DisplayStyle.Trinkets)then return"spoils_of_neltharus items 12"end end;if y.BeacontotheBeyond:IsEquippedAndReady()and(h:DebuffDown(x.TemporalWoundDebuff)and((B:CooldownRemains()>=20 or not M)and(C:CooldownRemains()>=20 or not N))or M and N or J<20)then if o(y.BeacontotheBeyond,nil,E.Commons.DisplayStyle.Trinkets,not h:IsInRange(45))then return"beacon_to_the_beyond items 14"end end;if y.BelorrelostheSuncaller:IsEquippedAndReady()and(h:DebuffDown(x.TemporalWoundDebuff)and((B:CooldownRemains()>=20 or not M)and(C:CooldownRemains()>=20 or not N))or M and N or J<20)then if o(y.BelorrelostheSuncaller,nil,E.Commons.DisplayStyle.Trinkets,not h:IsInRange(10))then return"belorrelos_the_suncaller items 16"end end;if B:IsReady()and(h:DebuffDown(x.TemporalWoundDebuff)and(x.BreathofEons:CooldownRemains()>=30 or not N)and not O)then if o(B,nil,E.Commons.DisplayStyle.Trinkets)then return"use_item for "..B:Name().." items 18"end end;if C:IsReady()and(h:DebuffDown(x.TemporalWoundDebuff)and(x.BreathofEons:CooldownRemains()>=30 or not M)and not P)then if o(C,nil,E.Commons.DisplayStyle.Trinkets)then return"use_item for "..C:Name().." items 20"end end end;if E.Commons.Enabled.Items then local ag,Z,ah=g:GetUseableItems(z,16)if ag and ag:IsReady()then if o(ag,nil,E.Commons.DisplayStyle.Items,not h:IsInRange(ah))then return"use_item for main_hand ("..ag:Name()..") items 22"end end end end;local function ai()if n()and x.TipTheScales:IsCastable()and(x.FireBreath:CooldownUp()and g:BuffUp(x.EbonMightSelfBuff))then if o(x.TipTheScales,E.Commons.GCDasOffGCD.TipTheScales)then return"tip_the_scales fb 2"end end;local aj=0;if x.FireBreath:IsCastable()then if g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>16 then aj=1 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>12 then aj=2 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>8 then aj=3 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>4 then aj=4 elseif g:BuffUp(x.TipTheScales)and not y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>8 then aj=3 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and not y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>16 then aj=1 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and not y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>12 then aj=2 elseif g:BuffRemains(x.EbonMightSelfBuff)>x.FireBreath:ExecuteTime()and not y.NeltharionsCalltoChaos:IsEquipped()and h:TimeToDie()>8 then aj=3 end;if aj>0 then if q(x.FireBreath,false,aj,not h:IsInRange(25))then return"fire_breath empower_to="..aj.." fb 4"end end end end;local function ak()if x.LivingFlame:IsReady()and((g:BuffUp(x.AncientFlameBuff)or g:Mana()>=200000 or not x.DreamofSpring:IsAvailable()or Q==0)and(EnemiesCount8ySplash==1 or x.PupilofAlexstrasza:IsAvailable()))then if o(x.LivingFlame,nil,nil,not h:IsSpellInRange(x.LivingFlame))then return"living_flame filler 2"end end;if x.AzureStrike:IsCastable()then if o(x.AzureStrike,nil,nil,not h:IsSpellInRange(x.AzureStrike))then return"azure_strike filler 4"end end end;local function al()Enemies25y=g:GetEnemiesInRange(25)Enemies8ySplash=h:GetEnemiesInSplashRange(8)if m()then EnemiesCount8ySplash=h:GetEnemiesInSplashRangeCount(8)else EnemiesCount8ySplash=1 end;if D.TargetIsValid()or g:AffectingCombat()then I=d.BossFightRemains()J=I;if J==11111 then J=d.FightRemains(Enemies25y,false)end;K=g:GCD()+0.25 end;if D.TargetIsValid()then if not g:AffectingCombat()and not g:IsCasting()then local am=aa()if am then return am end end;local am=D.Interrupt(x.Quell,E.Commons.OffGCDasOffGCD.Quell,U)if am then return am end;if x.Unravel:IsReady()then if o(x.Unravel,E.Commons.GCDasOffGCD.Unravel,nil,not h:IsSpellInRange(x.Unravel))then return"unravel main 2"end end;VarTempWound=a2(Enemies25y)if x.Prescience:IsCastable()and((x.Prescience:FullRechargeTime()<=K*3 or x.EbonMight:CooldownRemains()<=K*3 and g:BuffRemains(x.EbonMightSelfBuff)-K*3<=a7()*0.4 or VarTempWound>=K+x.Eruption:CastTime()or J<=30)and g:BuffStack(x.TremblingEarthBuff)+x.PrescienceBuff:AuraActiveCount()<=5+t(x.Prescience:FullRechargeTime()<=K*3))then if o(x.Prescience,nil,E.Augmentation.DisplayStyle.AugBuffs)then return"prescience main 4"end end;if g:BuffRemains(x.EbonMightSelfBuff)-x.EbonMight:CastTime()<=a7()*0.4 and(x.PrescienceBuff:AuraActiveCount()>=2 and d.CombatTime()<=10 or x.PrescienceBuff:AuraActiveCount()>=3 or g:BuffRemains(x.EbonMightSelfBuff)>=x.EbonMight:CastTime()or a8()<=2)then local am=ad()if am then return am end end;if S>0 and d.CombatTime()<S then local am=ae()if am then return am end;if q(x.Pool,false,"WAIT")then return"Wait for OpenerFiller()"end end;if E.Commons.Enabled.Potions and(h:DebuffUp(x.TemporalWoundDebuff)and g:BuffUp(x.EbonMightSelfBuff))then local an=D.PotionSelected()if an and an:IsReady()then if o(an,nil,E.Commons.DisplayStyle.Potions)then return"potion main 6"end end end;if E.Commons.Enabled.Trinkets or E.Commons.Enabled.Items then local am=af()if am then return am end end;if x.DeepBreath:IsCastable()then if o(x.DeepBreath,E.Augmentation.GCDasOffGCD.BreathOfEons,nil,not h:IsInRange(50))then return"deep_breath main 8"end end;if x.TimeSkip:IsAvailable()and x.TimeSkip:CooldownUp()and not x.InterwovenThreads:IsAvailable()then local am=ai()if am then return am end end;if x.Upheaval:IsCastable()and(g:BuffRemains(x.EbonMightSelfBuff)>g:EmpowerCastTime(1)and x.TimeSkip:IsAvailable()and x.TimeSkip:CooldownUp()and not x.InterwovenThreads:IsAvailable())then if q(x.Upheaval,false,"1",not h:IsInRange(25),E.Commons.EmpoweredFontSize)then return"upheaval empower_to=1 main 10"end end;if n()and x.BreathofEons:IsCastable()and x.BreathofEons:TimeSinceLastCast()>=117 and((x.EbonMight:CooldownRemains()<=4 or g:BuffUp(x.EbonMightSelfBuff))and h:TimeToDie()>15 and(not y.NymuesUnravelingSpindle:IsEquipped()or y.NymuesUnravelingSpindle:CooldownRemains()>=10 or J<30)or J<30)then if o(x.BreathofEons,E.Augmentation.GCDasOffGCD.BreathOfEons,nil,not h:IsInRange(50))then return"breath_of_eons main 12"end end;if x.LivingFlame:IsReady()and(g:BuffUp(x.LeapingFlamesBuff)and x.FireBreathDebuff:CooldownUp())then if o(x.LivingFlame,nil,nil,not h:IsSpellInRange(x.LivingFlame))then return"living_flame main 14"end end;local am=ai()if am then return am end;if x.Upheaval:IsCastable()and g:BuffRemains(x.EbonMightSelfBuff)>g:EmpowerCastTime(1)then if q(x.Upheaval,false,"1",not h:IsInRange(25),E.Commons.EmpoweredFontSize)then return"upheaval empower_to=1 main 16"end end;if n()and x.TimeSkip:IsCastable()and x.FireBreath:CooldownRemains()+x.Upheaval:CooldownRemains()+x.Prescience:FullRechargeTime()>35 then if o(x.TimeSkip,E.Augmentation.GCDasOffGCD.TimeSkip)then return"time_skip main 18"end end;if x.EmeraldBlossom:IsReady()and(x.DreamofSpring:IsAvailable()and g:BuffUp(x.EssenceBurstBuff)and(Q==2 or Q==1 and g:BuffDown(x.AncientFlameBuff))and(g:BuffUp(x.EbonMightSelfBuff)or g:EssenceDeficit()==0 or g:BuffStack(x.EssenceBurstBuff)==L and x.EbonMight:CooldownRemains()>4))then if o(x.EmeraldBlossom,E.Augmentation.GCDasOffGCD.EmeraldBlossom)then return"emerald_blossom main 20"end end;if x.Eruption:IsReady()and(g:BuffRemains(x.EbonMightSelfBuff)>x.Eruption:ExecuteTime()or g:EssenceDeficit()==0 or g:BuffStack(x.EssenceBurstBuff)==L and x.EbonMight:CooldownRemains()>4)then if o(x.Eruption,nil,nil,not h:IsInRange(25))then return"eruption main 22"end end;if x.BlisteringScales:IsCastable()and(a0()==0 and g:BuffDown(x.EbonMightSelfBuff))then if o(x.BlisteringScales,nil,E.Augmentation.DisplayStyle.AugBuffs)then return"blistering_scales main 24"end end;if x.EmeraldBlossom:IsReady()and(g:BuffDown(x.EbonMightSelfBuff)and x.AncientFlame:IsAvailable()and x.ScarletAdaptation:IsAvailable()and not x.DreamofSpring:IsAvailable()and g:BuffDown(x.AncientFlameBuff)and EnemiesCount8ySplash==1)then if o(x.EmeraldBlossom,E.Augmentation.GCDasOffGCD.EmeraldBlossom)then return"emerald_blossom main 26"end end;if x.VerdantEmbrace:IsReady()and(g:BuffDown(x.EbonMightSelfBuff)and x.AncientFlame:IsAvailable()and x.ScarletAdaptation:IsAvailable()and g:BuffDown(x.AncientFlameBuff)and(not x.DreamofSpring:IsAvailable()or g:Mana()>=200000)and EnemiesCount8ySplash==1)then if o(x.VerdantEmbrace,E.Augmentation.GCDasOffGCD.VerdantEmbrace)then return"verdant_embrace main 28"end end;local am=ak()if am then return am end;if q(x.Pool,false,"WAIT")then return"Wait/Pool"end end end;local function ao()x.PrescienceBuff:RegisterAuraTracking()l.Print("Augmentation Evoker rotation has been updated for patch 10.2.0.")end;l.SetAPL(1473,al,ao)