local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.CastSuggested;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[12]local t=not HeroRotationCharDB.Toggles[15]local u=HeroRotationCharDB.Toggles[40]local v=HeroRotationCharDB.Toggles[42]local w=HeroRotationCharDB.Toggles[43]local x=HeroRotationCharDB.Toggles[41]local y=HeroRotationCharDB.Toggles[45]local z=HeroRotationCharDB.Toggles[46]local A=HeroRotationCharDB.Toggles[47]local B=HeroRotationCharDB.Toggles[48]local C=HeroRotationCharDB.Toggles[49]local D;local E=GetInventoryItemID("player",13)local F=GetInventoryItemID("player",14)local G=HeroRotationCharDB.Toggles[44]local H=l.Commons.Everyone.num;local I=l.Commons.Everyone.bool;local J=math.min;local K=math.max;local L=0;local M=0;local N=false;local O=j.DemonHunter.Havoc;local P=k.DemonHunter.Havoc;local Q={P.AlgetharPuzzleBox:ID()}local R=g:GetEquipment()local S=R[13]and k(R[13])or k(0)local T=R[14]and k(R[14])or k(0)local U,V;local W,X;local Y=l.Commons.Everyone;local Z={General=l.GUISettings.General,Commons=l.GUISettings.APL.DemonHunter.Commons,Havoc=l.GUISettings.APL.DemonHunter.Havoc}local _={{O.FelEruption,"Cast Fel Eruption (Interrupt)",function()return true end},{O.ChaosNova,"Cast Chaos Nova (Interrupt)",function()return true end}}local a0=false;local a1=false;local a2=false;local a3=false;local a4=false;local a5=false;local a6=false;local a7=O.AFireInside:IsAvailable()and 5 or 1;local a8=g:GCD()+0.25;local a9=0;local aa=0;local ab=false;local ac=11111;local ad=11111;local ae=true;local af;local ag;local ah;local function H(ai)if ai then return 1 else return 0 end end;local function I(ai)return ai~=0 end;d:RegisterForEvent(function()a1=false;a2=false;a3=false;a4=false;a5=false;ac=11111;ad=11111 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()R=g:GetEquipment()S=R[13]and k(R[13])or k(0)T=R[14]and k(R[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()a7=O.AFireInside:IsAvailable()and 5 or 1 end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")local function aj(ak)if BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and ak:GUID()==f("mouseover"):GUID()then if O.DemonBlades:IsAvailable()then M=1111 else M=111 end;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and Z.Havoc.TargetSwap=="AutoSwap"and ak:GUID()~=h:GUID()and not s then M=999;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and ak:GUID()==h:GUID()and h:IsInRange(8)then L=162243;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)then return true end end;local function al(ak)return ak:DebuffRemains(O.BurningWoundDebuff)end;local function am(ak)if BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and ak:GUID()==f("mouseover"):GUID()then if O.DemonBlades:IsAvailable()then M=1111 else M=111 end;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and Z.Havoc.TargetSwap=="AutoSwap"and ak:GUID()~=h:GUID()and not s then M=999;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)and ak:GUID()==h:GUID()then L=162243;return true elseif BurningWoundEquipped and ak:DebuffRemains(O.BurningWoundDebuff)<4 and ak:IsInRange(8)then return true end end;local function an(ao)if O.Felblade:TimeSinceLastCast()<=g:GCD()then return true elseif O.VengefulRetreat:TimeSinceLastCast()<1.0 then return false end;return ao and h:IsInMeleeRange(ao)or h:IsInMeleeRange(5)end;local function ap()return Z.Havoc.ConserveFelRush and O.FelRush:Charges()==2 and not h:IsInRange(5)end;local function aq(ak)return ak:DebuffRemains(O.BurningWoundDebuff)or ak:DebuffRemains(O.BurningWoundLegDebuff)end;local function ar(ak)return O.BurningWound:IsAvailable()and ak:DebuffRemains(O.BurningWoundDebuff)<4 and O.BurningWoundDebuff:AuraActiveCount()<J(W,3)end;local function as()a0=S:Cooldown()==180 or T:Cooldown()==180;aa=0;if S:HasStatAnyDps()and(not T:HasStatAnyDps()or S:Cooldown()>=T:Cooldown())then aa=1 end;if T:HasStatAnyDps()and(not S:HasStatAnyDps()or T:Cooldown()>=S:Cooldown())then aa=2 end;if O.ArcaneTorrent:IsCastable()and n()then if o(O.ArcaneTorrent,nil,nil,not h:IsInRange(8))then return"arcane_torrent precombat 2"end end;if O.ImmolationAura:IsCastable()and not v then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura precombat 6"end end;if O.SigilofFlame:IsCastable()and not P.AlgetharPuzzleBox:IsEquipped()then if o(O.SigilofFlame,nil,nil,not h:IsInRange(30))then L=204596;return"sigil_of_flame precombat 8"end end;if not h:IsInMeleeRange(5)and not w and O.Felblade:IsCastable()then if o(O.Felblade,nil,nil,not h:IsSpellInRange(O.Felblade))then L=183226;return"felblade precombat 9"end end;if not h:IsInMeleeRange(5)and O.FelRush:IsCastable()and not u and N and(not O.Felblade:IsAvailable()or O.Felblade:CooldownDown()and not g:PrevGCDP(1,O.Felblade))then if o(O.FelRush,nil,nil,not h:IsInRange(15))then L=195072;return"fel_rush precombat 10"end end;if h:IsInMeleeRange(5)and(O.DemonsBite:IsCastable()or O.DemonBlades:IsAvailable())then if O.DemonBlades:IsAvailable()and IsCurrentSpell(6603)~=true then if o(O.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then L=1162243;return"demons_bite or demon_blades precombat 4"end else if o(O.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then L=162243;return"demons_bite or demon_blades precombat 4"end end end end;local function at()if g:BuffDown(O.FelBarrage)then if O.DeathSweep:IsReady()then if o(O.DeathSweep,nil,nil,not an(8))then L=210152;return"death_sweep meta_end 2"end end;if O.Annihilation:IsReady()then if o(O.Annihilation,nil,nil,not an(5))then L=201427;return"annihilation meta_end 4"end end end end;local function au()if n()then if ah and O.Metamorphosis:IsCastable()and not O.Demonic:IsAvailable()then if o(O.Metamorphosis,nil,nil,not h:IsInRange(40))then L=191427;return"metamorphosis cooldown 2"end end;if ah and O.Metamorphosis:IsCastable()and(O.Demonic:IsAvailable()and(not O.ChaoticTransformation:IsAvailable()and O.EyeBeam:CooldownDown()or O.EyeBeam:CooldownRemains()>20 and(not a1 or g:PrevGCDP(1,O.DeathSweep)or g:PrevGCDP(2,O.DeathSweep))or ad<25+H(O.ShatteredDestiny:IsAvailable())*70 and O.EyeBeam:CooldownDown()and O.BladeDance:CooldownDown())and g:BuffDown(O.InnerDemonBuff))then if o(O.Metamorphosis,nil,nil,not h:IsInRange(40))then L=191427;return"metamorphosis cooldown 4"end end end;if Z.Commons.Enabled.Potions and(g:BuffRemains(O.MetamorphosisBuff)>25 or g:BuffUp(O.MetamorphosisBuff)and O.Metamorphosis:CooldownUp()or ad<60 or a9>0.1 and a9<10)then local av=Y.PotionSelected()if av and av:IsReady()then if o(av,nil,nil)then L=4;return"potion cooldown 6"end end end;if n()and O.ElysianDecree:IsCastable()and h:DebuffDown(O.EssenceBreakDebuff)then if o(O.ElysianDecree,nil,nil,not h:IsInRange(30))then L=306830;return"elysian_decree cooldown 8"end end;if Z.Commons.Enabled.Trinkets then local aw=g:GetUseableTrinkets(Q,13)if aw then if o(aw,nil,nil)then L=20;return"trinket1 main 10"end end;local ax=g:GetUseableTrinkets(Q,14)if ax then if o(ax,nil,nil)then L=25;return"trinket2 main 12"end end end end;local function ay()r=HeroRotationCharDB.Toggles[5]q=HeroRotationCharDB.Toggles[4]s=HeroRotationCharDB.Toggles[12]t=not HeroRotationCharDB.Toggles[15]u=HeroRotationCharDB.Toggles[40]x=HeroRotationCharDB.Toggles[41]v=HeroRotationCharDB.Toggles[42]w=HeroRotationCharDB.Toggles[43]G=HeroRotationCharDB.Toggles[44]y=HeroRotationCharDB.Toggles[45]z=HeroRotationCharDB.Toggles[46]A=HeroRotationCharDB.Toggles[47]B=HeroRotationCharDB.Toggles[48]C=HeroRotationCharDB.Toggles[49]E=GetInventoryItemID("player",13)F=GetInventoryItemID("player",14)N=Z.Havoc.FelRushMode=="All In"or Z.Havoc.FelRushMode=="Safe"and O.Felblade:CooldownRemains(BypassRecovery)<=0 or Z.Havoc.FelRushMode=="w/ Gap Closer"and(O.Felblade:CooldownRemains(BypassRecovery)<=0 or O.Metamorphosis:CooldownRemains(BypassRecovery)<=0 and MetaReady or O.FelRush:Charges()==2 or O.TheHunt:CooldownRemains(BypassRecovery)<=0)D=Z.Havoc.VengefulRetreatMode=="All In"or Z.Havoc.VengefulRetreatMode=="Safe"and O.Felblade:CooldownRemains(BypassRecovery)<=0 or Z.Havoc.VengefulRetreatMode=="w/ Gap Closer"and(O.Felblade:CooldownRemains(BypassRecovery)<=0 or O.Metamorphosis:CooldownRemains(BypassRecovery)<=0 and MetaReady or O.FelRush:CooldownRemains(BypassRecovery)<=0 or O.TheHunt:CooldownRemains(BypassRecovery)<=0)if not h:IsInMeleeRange(5)and not w and O.Felblade:IsCastable()and(g:AffectingCombat()or r)then if o(O.Felblade,nil,nil,not h:IsSpellInRange(O.Felblade))then L=183226;return"felblade precombat 9"end end;af=false;ag=false;ah=false;if Z.Havoc.Metamorphosis=="CDs"and n()or Z.Havoc.Metamorphosis=="Small CDs"and q or Z.Havoc.Metamorphosis=="Always"then ah=true end;if Z.Havoc.TheHunt=="CDs"and n()or Z.Havoc.TheHunt=="Small CDs"and q or Z.Havoc.TheHunt=="Always"then ag=true end;if Z.Havoc.EyeBeam=="CDs"and n()or Z.Havoc.EyeBeam=="Small CDs"and q or Z.Havoc.EyeBeam=="Always"then af=true end end;local function az()if g:IsChanneling(O.EyeBeam)then if o(O.Pool)then L=9999;return"casting EB"end end;if m()then U=g:GetEnemiesInMeleeRange(5)V=g:GetEnemiesInMeleeRange(20)W=#U>0 and#U or 1;X=#V else W=1;X=1 end;if not BotOn then M=0;L=0 end;if M>0 then M=0 end;if L>0 then L=0 end;if x and O.Imprison:IsCastable(BypassRecovery)and O.Imprison:CooldownRemains()<=0 and f("mouseover"):GUID()~=nil then if o(O.Imprison,nil,nil,nil)then M=231;return"queue Imprison MO"end elseif x and O.Imprison:IsCastable(BypassRecovery)and O.Imprison:CooldownRemains()<=0 and Y.TargetIsValid()then if o(O.Imprison,nil,nil,nil)then L=217832;return"queue Imprison"end elseif(not O.Imprison:IsUsableP()or O.Imprison:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[41]=not HeroRotationCharDB.Toggles[41]l.Print("Imprison Queue is now "..(HeroRotationCharDB.Toggles[41]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and O.FelEruption:IsCastable(BypassRecovery)and O.FelEruption:CooldownRemains(BypassRecovery)<=0 and O.FelEruption:IsAvailable()and f("mouseover"):GUID()~=nil then if o(O.FelEruption,nil,nil,nil)then M=1211881;return"queue Fel Eruption"end elseif y and O.FelEruption:IsCastable(BypassRecovery)and O.FelEruption:CooldownRemains(BypassRecovery)<=0 and O.FelEruption:IsAvailable()and Y.TargetIsValid()then if o(O.FelEruption,nil,nil,nil)then L=211881;return"queue Fel Eruption"end elseif(not O.FelEruption:IsUsableP()and g:Fury()>10 or O.FelEruption:CooldownRemains()>0 or not O.FelEruption:IsAvailable())and y then HeroRotationCharDB.Toggles[45]=not HeroRotationCharDB.Toggles[45]l.Print("Fel Eruption Queue is now "..(HeroRotationCharDB.Toggles[45]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and O.ChaosNova:IsCastable(BypassRecovery)and O.ChaosNova:CooldownRemains(BypassRecovery)<=0 and g:Fury()>=30 then if o(O.ChaosNova,nil,nil,nil)then L=179057;return"queue Chaos Nova MO"end elseif(not O.ChaosNova:IsUsableP()and g:Fury()>30 or O.ChaosNova:CooldownRemains()>0 or not Y.TargetIsValid())and z then HeroRotationCharDB.Toggles[46]=not HeroRotationCharDB.Toggles[46]l.Print("ChaosNova Queue is now "..(HeroRotationCharDB.Toggles[46]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and O.FelRush:IsCastable(BypassRecovery)and O.FelRush:CooldownRemains(BypassRecovery)<=0 then if o(O.FelRush,nil,nil,nil)then L=195072;return"queue FelRush"end elseif(not O.FelRush:IsUsableP()or O.FelRush:CooldownRemains()>0)and B then HeroRotationCharDB.Toggles[48]=not HeroRotationCharDB.Toggles[48]l.Print("Fel Rush Queue is now "..(HeroRotationCharDB.Toggles[48]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if C and O.Darkness:IsCastable(BypassRecovery)and O.Darkness:CooldownRemains(BypassRecovery)<=0 then if o(O.Darkness,nil,nil,nil)then L=196718;return"queue FelRush"end elseif(not O.Darkness:IsUsableP()or O.Darkness:CooldownRemains()>0)and C then HeroRotationCharDB.Toggles[49]=not HeroRotationCharDB.Toggles[49]l.Print("Darkness Queue is now "..(HeroRotationCharDB.Toggles[49]and"|cff00ff00on|r."or"|cffff0000off|r."))end;ay()for aA=1,25 do local aB,aC,aC,aD=UnitBuff("target",aA)if aD~=nil and aD=="Magic"then if O.ConsumeMagic:IsCastable()and G and h:IsInRange(30)then if o(O.ConsumeMagic,nil)then L=278326;return"Consume Magic"end end end end;if O.Blur:IsCastable()and g:HealthPercentage()<=Z.Havoc.BlurHealthThreshold and g:AffectingCombat()then if o(O.Blur,nil)then L=198589;return"Blur defensives (Danger)"end end;if g:HealthPercentage()<Z.Havoc.HealthstoneHP and P.Healthstone:IsReady()and P.Healthstone:CooldownRemains()<=0 then if l.Cast(P.Healthstone,nil)then L=40;return"Healthstone HP"end end;if g:HealthPercentage()<Z.Havoc.HealPotHP and P.HealPot:IsReady()and P.HealPot:CooldownRemains()<=0 then if l.Cast(P.HealPot,nil)then L=41;return"HealPot HP"end end;if Y.TargetIsValid()or g:AffectingCombat()then if M>0 then M=0 end;if L>0 then L=0 end;ac=d.BossFightRemains()ad=ac;if ad==11111 then ad=d.FightRemains(U,false)end;a8=g:GCD()+0.25;a9=d.CombatTime()end;if Y.TargetIsValid()and(g:AffectingCombat()or r)then if not g:AffectingCombat()and r then local aE=as()if aE then return aE end end;a1=O.FirstBlood:IsAvailable()or O.TrailofRuin:IsAvailable()or O.ChaosTheory:IsAvailable()and g:BuffDown(O.ChaosTheoryBuff)or W>1;a2=a1 and g:Fury()<75-H(O.DemonBlades:IsAvailable())*20 and O.BladeDance:CooldownRemains()<a8;a3=O.Demonic:IsAvailable()and not O.BlindFury:IsAvailable()and O.EyeBeam:CooldownRemains()<a8*2 and g:FuryDeficit()>30;a5=O.Momentum:IsAvailable()and g:BuffDown(O.MomentumBuff)or O.Inertia:IsAvailable()and g:BuffDown(O.InertiaBuff)local aF=K(O.EyeBeam:BaseDuration(),g:GCD())a6=O.Demonic:IsAvailable()and O.EssenceBreak:IsAvailable()and a0 and ad>O.Metamorphosis:CooldownRemains()+30+H(O.ShatteredDestiny:IsAvailable())*60 and O.Metamorphosis:CooldownRemains()<20 and O.Metamorphosis:CooldownRemains()>aF+a8*(H(O.InnerDemon:IsAvailable())+2)if not h:IsInMeleeRange(5)then if O.FelRush:Charges()==2 then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 6"end end;if o(O.Felblade,nil,nil,not h:IsSpellInRange(O.Felblade))then L=183226;return"felblade main 60"end end;if O.ImmolationAura:IsCastable()and not v and(O.Ragefire:IsAvailable()and W>=3 and(O.BladeDance:CooldownDown()or h:DebuffDown(O.EssenceBreakDebuff)))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 2"end end;local aE=Y.Interrupt(10,O.Disrupt,Z.Commons.OffGCDasOffGCD.Disrupt,_)if aE then return aE end;if O.ImmolationAura:IsCastable()and not v and(O.AFireInside:IsAvailable()and O.Inertia:IsAvailable()and g:BuffDown(O.UnboundChaosBuff)and O.ImmolationAura:FullRechargeTime()<a8*2 and h:DebuffDown(O.EssenceBreakDebuff))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 4"end end;if O.FelRush:IsCastable()and not u and N and ap()and(g:BuffUp(O.UnboundChaosBuff)and(O.ImmolationAura:Charges()==2 and h:DebuffDown(O.EssenceBreakDebuff)or g:PrevGCDP(1,O.EyeBeam)and g:BuffUp(O.InertiaBuff)and g:BuffRemains(O.InertiaBuff)<3))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 6"end end;local av=Y.PotionSelected()local aG=not Z.Commons.Enabled.Potions or not av or av:TimeSinceLastCast()<30 or not av:IsReady()if ag and O.TheHunt:IsCastable()and(a9<10 and aG and(not O.Inertia:IsAvailable()or g:BuffUp(O.MetamorphosisBuff)and h:DebuffDown(O.EssenceBreakDebuff)))then if o(O.TheHunt,nil,nil,not h:IsSpellInRange(O.TheHunt))then L=323639;return"the_hunt main 8"end end;if O.ImmolationAura:IsCastable()and(O.Inertia:IsAvailable()and(O.EyeBeam:CooldownRemains()<a8*2 or g:BuffUp(O.MetamorphosisBuff))and O.EssenceBreak:CooldownRemains()<a8*3 and g:BuffDown(O.UnboundChaosBuff)and g:BuffDown(O.InertiaBuff)and h:DebuffDown(O.EssenceBreakDebuff))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 10"end end;if O.ImmolationAura:IsCastable()and not v and(O.Inertia:IsAvailable()and g:BuffDown(O.UnboundChaosBuff)and(O.ImmolationAura:FullRechargeTime()<O.EssenceBreak:CooldownRemains()or not O.EssenceBreak:IsAvailable())and h:DebuffDown(O.EssenceBreakDebuff)and(g:BuffDown(O.MetamorphosisBuff)or g:BuffRemains(O.MetamorphosisBuff)>6)and O.BladeDance:CooldownDown()and(g:Fury()<75 or O.BladeDance:CooldownRemains()<a8*2))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 12"end end;if O.FelRush:IsCastable()and not u and N and ap()and(g:BuffUp(O.UnboundChaosBuff)and(g:BuffRemains(O.UnboundChaosBuff)<a8*2 or h:TimeToDie()<a8*2))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 14"end end;if O.FelRush:IsCastable()and not u and N and ap()and(O.Inertia:IsAvailable()and g:BuffDown(O.InertiaBuff)and g:BuffUp(O.UnboundChaosBuff)and O.EyeBeam:CooldownRemains()+3>g:BuffRemains(O.UnboundChaosBuff)and(O.BladeDance:CooldownDown()or O.EssenceBreak:CooldownUp()))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 16"end end;if O.FelRush:IsCastable()and not u and N and ap()and(g:BuffUp(O.UnboundChaosBuff)and O.Inertia:IsAvailable()and g:BuffDown(O.InertiaBuff)and(g:BuffUp(O.MetamorphosisBuff)or O.EssenceBreak:CooldownRemains()>10))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 18"end end;local aE=au()if aE then return aE end;if g:BuffUp(O.MetamorphosisBuff)and g:BuffRemains(O.MetamorphosisBuff)<a8 and W<3 then local aE=at()if aE then return aE end end;if O.Annihilation:IsReady()and(g:BuffUp(O.InnerDemonBuff)and O.Metamorphosis:CooldownRemains()<=g:GCD()*3)then if o(O.Annihilation,nil,nil,not an(5))then L=201427;return"annihilation main 20"end end;if O.VengefulRetreat:IsCastable()and not u and N and D and(O.EyeBeam:CooldownRemains()<0.3 and O.EssenceBreak:CooldownRemains()<a8*2 and a9>5 and g:Fury()>=30 and O.Inertia:IsAvailable())then if o(O.VengefulRetreat,nil)then L=198793;return"vengeful_retreat main 22"end end;if O.VengefulRetreat:IsCastable()and not u and N and D and(O.Initiative:IsAvailable()and O.EssenceBreak:IsAvailable()and a9>1 and(O.EssenceBreak:CooldownRemains()>15 or O.EssenceBreak:CooldownRemains()<a8 and(not O.Demonic:IsAvailable()or g:BuffUp(O.MetamorphosisBuff)or O.EyeBeam:CooldownRemains()>15+10*H(O.CycleofHatred:IsAvailable())))and(a9<30 or g:GCDRemains()-1<0)and(not O.Initiative:IsAvailable()or g:BuffRemains(O.InitiativeBuff)<a8 or a9>4))then if o(O.VengefulRetreat,nil)then L=198793;return"vengeful_retreat main 24"end end;if O.VengefulRetreat:IsCastable()and not u and N and D and(O.Initiative:IsAvailable()and O.EssenceBreak:IsAvailable()and a9>1 and(O.EssenceBreak:CooldownRemains()>15 or O.EssenceBreak:CooldownRemains()<a8*2 and(g:BuffRemains(O.InitiativeBuff)<a8 and not a6 and O.EyeBeam:CooldownRemains()<=g:GCDRemains()and g:Fury()>30 or not O.Demonic:IsAvailable()or g:BuffUp(O.MetamorphosisBuff)or O.EyeBeam:CooldownRemains()>15+10*H(O.CycleofHatred:IsAvailable())))and(g:BuffDown(O.UnboundChaosBuff)or g:BuffUp(O.InertiaBuff)))then if o(O.VengefulRetreat,nil)then L=198793;return"vengeful_retreat main 26"end end;if O.VengefulRetreat:IsCastable()and not u and N and D and(O.Initiative:IsAvailable()and not O.EssenceBreak:IsAvailable()and a9>1 and((g:BuffDown(O.InitiativeBuff)or g:PrevGCDP(1,O.DeathSweep)and O.Metamorphosis:CooldownUp()and O.ChaoticTransformation:IsAvailable())and O.Initiative:IsAvailable()))then if o(O.VengefulRetreat,nil)then L=198793;return"vengeful_retreat main 28"end end;if O.FelRush:IsCastable()and not u and N and ap()and(O.Momentum:IsAvailable()and g:BuffRemains(O.MomentumBuff)<a8*2 and O.EyeBeam:CooldownRemains()<=a8 and h:DebuffDown(O.EssenceBreakDebuff)and O.BladeDance:CooldownDown())then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 30"end end;if O.FelRush:IsCastable()and not u and N and ap()and(O.Inertia:IsAvailable()and g:BuffDown(O.InertiaBuff)and g:BuffUp(O.UnboundChaosBuff)and(g:BuffUp(O.MetamorphosisBuff)or O.EyeBeam:CooldownRemains()>O.ImmolationAura:Recharge()and O.EyeBeam:CooldownRemains()>4)and h:DebuffDown(O.EssenceBreakDebuff)and O.BladeDance:CooldownDown())then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 32"end end;if O.EssenceBreak:IsCastable()and((g:BuffRemains(O.MetamorphosisBuff)>a8*3 or O.EyeBeam:CooldownRemains()>10)and(not O.TacticalRetreat:IsAvailable()or g:BuffUp(O.TacticalRetreatBuff)or a9<10)and O.BladeDance:CooldownRemains()<=3.1*a8 or ad<6)then if o(O.EssenceBreak,nil,nil,not an(10))then L=258860;return"essence_break main 34"end end;if O.DeathSweep:IsReady()and(a1 and(not O.EssenceBreak:IsAvailable()or O.EssenceBreak:CooldownRemains()>a8*2)and g:BuffDown(O.FelBarrage))then if o(O.DeathSweep,nil,nil,not an(8))then L=210152;return"death_sweep main 36"end end;if ag and O.TheHunt:IsCastable()and(h:DebuffDown(O.EssenceBreakDebuff)and(a9<10 or O.Metamorphosis:CooldownRemains()>10 or not P.AlgetharPuzzleBox:IsEquipped())and(W==1 or W>3 or ad<10)and(h:DebuffDown(O.EssenceBreakDebuff)and(not O.FuriousGaze:IsAvailable()or g:BuffUp(O.FuriousGazeBuff)or g:HasTier(31,4))or not g:HasTier(30,2))and a9>10)then if o(O.TheHunt,nil,nil,not h:IsSpellInRange(O.TheHunt))then L=323639;return"the_hunt main 38"end end;if O.FelBarrage:IsCastable()and(W>1 or W==1 and g:FuryDeficit()<20 and g:BuffDown(O.MetamorphosisBuff))then if o(O.FelBarrage,nil,nil,not an(8))then L=211053;return"fel_barrage main 40"end end;if O.GlaiveTempest:IsReady()and((h:DebuffDown(O.EssenceBreakDebuff)or W>1)and g:BuffDown(O.FelBarrage))then if o(O.GlaiveTempest,nil)then L=342817;return"glaive_tempest main 42"end end;if O.Annihilation:IsReady()and(g:BuffUp(O.InnerDemonBuff)and O.EyeBeam:CooldownRemains()<=g:GCD()and g:BuffDown(O.FelBarrage))then if o(O.Annihilation,nil,nil,not an(5))then L=201427;return"annihilation main 44"end end;if O.FelRush:IsCastable()and not u and N and ap()and(O.Momentum:IsAvailable()and O.EyeBeam:CooldownRemains()<=a8 and g:BuffRemains(O.MomentumBuff)<5 and g:BuffDown(O.MetamorphosisBuff))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 46"end end;if af and O.EyeBeam:IsReady()and(h:DebuffDown(O.EssenceBreakDebuff)and(O.Metamorphosis:CooldownRemains()>30-H(O.CycleofHatred:IsAvailable())*15 or O.Metamorphosis:CooldownRemains()<a8*2 and(not O.EssenceBreak:IsAvailable()or O.EssenceBreak:CooldownRemains()<a8*1.5))and(g:BuffDown(O.MetamorphosisBuff)or g:BuffRemains(O.MetamorphosisBuff)>a8 or not O.RestlessHunter:IsAvailable())and(O.CycleofHatred:IsAvailable()or not O.Initiative:IsAvailable()or O.VengefulRetreat:CooldownRemains()>5 or a9<10)and g:BuffDown(O.InnerDemonBuff)or ad<15)then if o(O.EyeBeam,nil,nil,not an(10))then L=198013;return"eye_beam main 48"end end;if O.BladeDance:IsReady()and(a1 and(O.EyeBeam:CooldownRemains()>5 or P.AlgetharPuzzleBox:IsEquipped()and O.Metamorphosis:CooldownRemains()>10*g:SpellHaste()or not O.Demonic:IsAvailable())and g:BuffDown(O.FelBarrage)or g:HasTier(31,2))then if o(O.BladeDance,nil,nil,not an(8))then L=188499;return"blade_dance main 50"end end;if O.SigilofFlame:IsCastable()and(O.AnyMeansNecessary:IsAvailable()and h:DebuffDown(O.EssenceBreakDebuff)and W>=4)then if o(O.SigilofFlame,nil,nil,not h:IsInRange(30))then L=204596;return"sigil_of_flame main 52"end end;if O.ThrowGlaive:IsCastable()and(O.Soulscar:IsAvailable()and W>=2-H(O.FuriousThrows:IsAvailable())and h:DebuffDown(O.EssenceBreakDebuff)and(O.ThrowGlaive:FullRechargeTime()<a8*3 or W>1)and not g:HasTier(31,2))then if o(O.ThrowGlaive,nil,nil,not h:IsInRange(30))then L=185123;return"throw_glaive main 54"end end;if O.ImmolationAura:IsCastable()and not v and(W>=2 and g:Fury()<70 and h:DebuffDown(O.EssenceBreakDebuff))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 56"end end;if O.Annihilation:IsReady()and(not a2 and(O.EssenceBreak:CooldownDown()or not O.EssenceBreak:IsAvailable())and g:BuffDown(O.FelBarrage)or g:HasTier(30,2))then if o(O.Annihilation,nil,nil,not an(5))then L=201427;return"annihilation main 58"end end;if O.Felblade:IsCastable()and not w and ae and(g:FuryDeficit()>=40 and O.AnyMeansNecessary:IsAvailable()and h:DebuffDown(O.EssenceBreakDebuff)or O.AnyMeansNecessary:IsAvailable()and h:DebuffDown(O.EssenceBreakDebuff))then if o(O.Felblade,nil,nil,not h:IsSpellInRange(O.Felblade))then L=183226;return"felblade main 60"end end;if O.SigilofFlame:IsCastable()and(g:FuryDeficit()>=40 and O.AnyMeansNecessary:IsAvailable())then if o(O.SigilofFlame,nil,nil,not h:IsInRange(30))then L=204596;return"sigil_of_flame main 62"end end;if O.ThrowGlaive:IsReady()and(O.Soulscar:IsAvailable()and X>=2-H(O.FuriousThrows:IsAvailable())and h:DebuffDown(O.EssenceBreakDebuff)and not g:HasTier(31,2))then if o(O.ThrowGlaive,nil,nil,not h:IsSpellInRange(O.ThrowGlaive))then L=185123;return"throw_glaive main 64"end end;if O.ImmolationAura:IsCastable()and not v and(g:BuffStack(O.ImmolationAuraBuff)<a7 and h:IsInRange(8)and(g:BuffDown(O.UnboundChaosBuff)or not O.UnboundChaos:IsAvailable())and(O.ImmolationAura:Recharge()<O.EssenceBreak:CooldownRemains()or not O.EssenceBreak:IsAvailable()and O.EyeBeam:CooldownRemains()>O.ImmolationAura:Recharge()))then if o(O.ImmolationAura,nil,nil,not an(8))then L=258920;return"immolation_aura main 66"end end;if O.ThrowGlaive:IsReady()and(O.Soulscar:IsAvailable()and O.ThrowGlaive:FullRechargeTime()<O.BladeDance:CooldownRemains()and g:HasTier(31,2)and g:BuffDown(O.FelBarrage)and not a3)then if o(O.ThrowGlaive,nil,nil,not h:IsSpellInRange(O.ThrowGlaive))then L=185123;return"throw_glaive main 68"end end;if O.ChaosStrike:IsReady()and(not a2 and not a3 and g:BuffDown(O.FelBarrage))then if o(O.ChaosStrike,nil,nil,not h:IsSpellInRange(O.ChaosStrike))then L=162794;return"chaos_strike main 64"end end;if O.SigilofFlame:IsCastable()and(W==1 and g:FuryDeficit()>=30 and h:IsInRange(30))then if o(O.SigilofFlame,nil,nil,not h:IsInRange(30))then L=204596;return"sigil_of_flame main 72"end end;if O.Felblade:IsCastable()and not w and ae and g:FuryDeficit()>=40 then if o(O.Felblade,nil,nil,not h:IsSpellInRange(O.Felblade))then L=183226;return"felblade main 74"end end;if O.FelRush:IsCastable()and not u and N and ap()and(not O.Momentum:IsAvailable()and O.DemonBlades:IsAvailable()and O.EyeBeam:CooldownDown()and g:BuffDown(O.UnboundChaosBuff)and(O.FelRush:Recharge()<O.EssenceBreak:CooldownRemains()or not O.EssenceBreak:IsAvailable()))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 76"end end;if O.DemonsBite:IsCastable()then if Y.CastTargetIf(O.DemonsBite,U,"min",aq,ar,not h:IsSpellInRange(O.DemonsBite))then return"demons_bite main 72"end end;if O.FelRush:IsCastable()and not u and N and ap()and(not O.Momentum:IsAvailable()and not O.DemonBlades:IsAvailable()and W>1 and g:BuffDown(O.UnboundChaosBuff))then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 74"end end;if O.SigilofFlame:IsCastable()and(g:FuryDeficit()>=30 and h:IsInRange(30))then if o(O.SigilofFlame,nil,nil,not h:IsInRange(30))then L=204596;return"sigil_of_flame main 76"end end;if O.DemonsBite:IsCastable()then if O.DemonBlades:IsAvailable()and IsCurrentSpell(6603)~=true then if o(O.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then L=1162243;return"demons_bite or demon_blades precombat 4"end else if o(O.DemonsBite,nil,nil,not h:IsInMeleeRange(5))then L=162243;return"demons_bite or demon_blades precombat 4"end end end;if O.FelRush:IsCastable()and not u and N and ap()and(O.Momentum:IsAvailable()and g:BuffRemains(O.MomentumBuff)<=20)then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 80"end end;if O.FelRush:IsCastable()and not u and N and(not an(8)and not O.Momentum:IsAvailable()and ap())then if o(O.FelRush,nil,nil)then L=195072;return"fel_rush main 82"end end;if O.VengefulRetreat:IsCastable()and not u and N and D and(not O.Initiative:IsAvailable()and not an())then if o(O.VengefulRetreat,nil)then L=198793;return"vengeful_retreat main 84"end end;if O.ThrowGlaive:IsReady()and((O.DemonBlades:IsAvailable()or not h:IsInRange(12))and h:DebuffDown(O.EssenceBreakDebuff)and h:IsSpellInRange(O.ThrowGlaive)and not g:HasTier(31,2))then if o(O.ThrowGlaive,nil,nil,not h:IsSpellInRange(O.ThrowGlaive))then L=185123;return"throw_glaive main 86"end end;if l.CastAnnotated(O.Pool,false,"WAIT")then return"Wait/Pool Resources"end end end;local function aH()O.BurningWoundDebuff:RegisterAuraTracking()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]l.ToggleIconFrame:UpdateButtonText(5)end end;function ReturnSpell()if L==0 then return 0 else return L end end;function ReturnSpellMO()if M==0 then return 0 else return M end end;l.SetAPL(577,az,aH)