local a=HeroLib;local b=HeroCache;local c=a.Unit;local d=c.Player;local e=c.Pet;local f=c.Target;local g=a.Spell;local h=a.Item;local i=HeroRotation;local j=g.Druid.Guardian;local k=g.Druid.Balance;local l=g.Druid.Feral;a.AddCoreOverride("Player.AstralPowerP",function()local m=d:AstralPower()if not d:IsCasting()then return m else if d:IsCasting(k.Wrath)then return m+6 elseif d:IsCasting(k.Starfire)or d:IsCasting(k.StellarFlare)then return m+8 elseif d:IsCasting(k.NewMoon)then return m+10 elseif d:IsCasting(k.HalfMoon)then return m+20 elseif d:IsCasting(k.FullMoon)then return m+40 else return m end end end,102)local n;n=a.AddCoreOverride("Spell.IsCastable",function(self,o,p,q,r,s)local t=true;if o then local u=q or f;t=u:IsInRange(o,p)end;local v=n(self,o,p,q,r,s)if self==k.MoonkinForm then return v and d:BuffDown(self)elseif self==k.StellarFlare then return v and not d:IsCasting(self)elseif self==k.Wrath or self==k.Starfire then return v and not(d:IsCasting(self)and self:Count()==1)else return v end end,102)local w;w=a.AddCoreOverride("Spell.IsCastable",function(self,o,p,q,r,s)local v=w(self,o,p,q,r,s)if self==l.CatForm or self==l.MoonkinForm then return v and d:BuffDown(self)elseif self==l.Prowl then return v and self:IsUsable()else return v end end,103)local x;x=a.AddCoreOverride("Spell.IsCastable",function(self,o,p,q,r,s)local v=x(self,o,p,q,r,s)if self==j.Thrash then return v and(d:Rage()<=95 and f:DebuffRemains(j.ThrashDebuff)>d:GCD()*2 or f:DebuffStack(j.ThrashDebuff)<3)else return v end end,104)