local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Pet;local i=f.Target;local j=d.Spell;local k=d.MultiSpell;local l=d.Item;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=m.Cast;local q=HeroRotationCharDB.Toggles[4]local r=HeroRotationCharDB.Toggles[5]local s=HeroRotationCharDB.Toggles[6]local t=HeroRotationCharDB.Toggles[12]local u=HeroRotationCharDB.Toggles[15]local v=HeroRotationCharDB.Toggles[60]local w=false;local x={228318,178658,333227,334800,334967,324737,326450,334470,326450,320703,320012,324085,333241,331510}local y={325552,326836,326092,334926,328395,330725,333299,323831,328494,322968,334496,334493,319603}local GetCombatRating=GetCombatRating;local z=math.floor;local A=math.ceil;local B=math.max;local C=m.Commons.Everyone;local D={General=m.GUISettings.General,Commons=m.GUISettings.APL.Druid.Commons,Balance=m.GUISettings.APL.Druid.Balance}local E=j.Druid.Balance;local F=l.Druid.Balance;local G={F.EmpyrealOrdinance:ID(),F.InscrutableQuantumDevice:ID(),F.ShadowedOrbofTorment:ID(),F.SoullettingRuby:ID()}local H=g:GetEquipment()local I=l(0)local J=l(0)if H[13]then I=l(H[13])end;if H[14]then J=l(H[14])end;local K;local L;local M;local N;local O;local P;local Q;local R;local S;local T;local U;local V;local W;local X;local Y;local Z;local _;local a0;local a1;local a2;local a3;local a4;local a5;local a6;local a7;local a8;local a9;local aa;local ab;local ac=false;local ad;local ae=0;local af=0;local ag=0;local ah=g:CovenantID()local ai=E.Incarnation:IsAvailable()and E.Incarnation or E.CelestialAlignment;local aj=false;local ak=false;local al=false;local am=false;local an=false;local ao=false;local ap=false;local aq={5,5.5,6,6.5,7,7.5,8,8.5,9,9.5,10,10.5,11,11.5,12}local ar=E.PreciseAlignment:ConduitEnabled()and aq[E.PreciseAlignment:ConduitRank()]or 0;local as=g:HasLegendaryEquipped(47)local at=g:HasLegendaryEquipped(48)local au=g:HasLegendaryEquipped(50)local av=g:HasLegendaryEquipped(51)local aw=g:HasLegendaryEquipped(52)local ax=g:HasLegendaryEquipped(53)local ay=g:HasLegendaryEquipped(220)or g:HasUnity()and E.RavenousFrenzy:IsAvailable()local az=g:HasLegendaryEquipped(226)or g:HasUnity()and E.ConvoketheSpirits:IsAvailable()d:RegisterForEvent(function()H=g:GetEquipment()I=l(0)J=l(0)if H[13]then I=l(H[13])end;if H[14]then J=l(H[14])end;as=g:HasLegendaryEquipped(47)at=g:HasLegendaryEquipped(48)au=g:HasLegendaryEquipped(50)av=g:HasLegendaryEquipped(51)aw=g:HasLegendaryEquipped(52)ax=g:HasLegendaryEquipped(53)ay=g:HasLegendaryEquipped(220)or g:HasUnity()and E.RavenousFrenzy:IsAvailable()az=g:HasLegendaryEquipped(226)or g:HasUnity()and E.ConvoketheSpirits:IsAvailable()end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()ac=false end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()E.AdaptiveSwarm:RegisterInFlight()end,"LEARNED_SPELL_IN_TAB")E.AdaptiveSwarm:RegisterInFlight()d:RegisterForEvent(function()ai=E.Incarnation:IsAvailable()and E.Incarnation or E.CelestialAlignment end,"PLAYER_TALENT_UPDATE")d:RegisterForEvent(function()ar=E.PreciseAlignment:ConduitEnabled()and aq[E.PreciseAlignment:ConduitRank()]or 0 end,"SOULBIND_ACTIVATED","SOULBIND_CONDUIT_COLLECTION_UPDATED","SOULBIND_CONDUIT_INSTALLED","SOULBIND_NODE_UPDATED")d:RegisterForEvent(function()ah=g:CovenantID()end,"COVENANT_CHOSEN")local aA,aB;local aC,aD;local function aE(aF)if aF then return 1 else return 0 end end;local function aG(aF)return aF~=0 end;local function aH(aI)if aI:DebuffRemains(E.MoonfireDebuff)>aI:DebuffRemains(E.SunfireDebuff)*22/18 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=193402;return true elseif aI:DebuffRemains(E.MoonfireDebuff)>aI:DebuffRemains(E.SunfireDebuff)*22/18 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRemains(E.MoonfireDebuff)>aI:DebuffRemains(E.SunfireDebuff)*22/18 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=93402;return true elseif aI:DebuffRemains(E.MoonfireDebuff)>aI:DebuffRemains(E.SunfireDebuff)*22/18 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aJ(aI)if(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()and(g:BuffDown(E.AdaptiveSwarmHeal)or g:BuffRemains(E.AdaptiveSwarmHeal)>5)or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3 and aI:DebuffUp(E.AdaptiveSwarmDebuff))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=1325727;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()and(g:BuffDown(E.AdaptiveSwarmHeal)or g:BuffRemains(E.AdaptiveSwarmHeal)>5)or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3 and aI:DebuffUp(E.AdaptiveSwarmDebuff))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()and(g:BuffDown(E.AdaptiveSwarmHeal)or g:BuffRemains(E.AdaptiveSwarmHeal)>5)or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3 and aI:DebuffUp(E.AdaptiveSwarmDebuff))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=325727;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()and(g:BuffDown(E.AdaptiveSwarmHeal)or g:BuffRemains(E.AdaptiveSwarmHeal)>5)or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3 and aI:DebuffUp(E.AdaptiveSwarmDebuff))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aK(aI)if(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.MoonfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.MoonfireDebuff)or T)and aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=18921;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.MoonfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.MoonfireDebuff)or T)and aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.MoonfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.MoonfireDebuff)or T)and aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=8921;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.MoonfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.MoonfireDebuff)or T)and aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aL(aI)if(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.SunfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.SunfireDebuff)or T)and aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=193402;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.SunfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.SunfireDebuff)or T)and aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.SunfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.SunfireDebuff)or T)and aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=93402;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.SunfireDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.SunfireDebuff)or T)and aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>12 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aM(aI)if(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.StellarFlareDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.StellarFlareDebuff)or T)and aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=1202347;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.StellarFlareDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.StellarFlareDebuff)or T)and aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.StellarFlareDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.StellarFlareDebuff)or T)and aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=202347;return true elseif(g:BuffRemains(E.EclipseSolar)>aI:DebuffRemains(E.StellarFlareDebuff)or g:BuffRemains(E.EclipseLunar)>aI:DebuffRemains(E.StellarFlareDebuff)or T)and aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aN(aI)if(aI:DebuffRefreshable(E.SunfireDebuff)or g:BuffRemains(E.EclipseSolar)<3 and am and aI:DebuffRemains(E.SunfireDebuff)<14 and E.SouloftheForest:IsAvailable())and aI:TimeToDie()>14-aD+aI:DebuffRemains(E.SunfireDebuff)and(aj or aI:DebuffRemains(E.SunfireDebuff)<a8)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=193402;return true elseif(aI:DebuffRefreshable(E.SunfireDebuff)or g:BuffRemains(E.EclipseSolar)<3 and am and aI:DebuffRemains(E.SunfireDebuff)<14 and E.SouloftheForest:IsAvailable())and aI:TimeToDie()>14-aD+aI:DebuffRemains(E.SunfireDebuff)and(aj or aI:DebuffRemains(E.SunfireDebuff)<a8)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(aI:DebuffRefreshable(E.SunfireDebuff)or g:BuffRemains(E.EclipseSolar)<3 and am and aI:DebuffRemains(E.SunfireDebuff)<14 and E.SouloftheForest:IsAvailable())and aI:TimeToDie()>14-aD+aI:DebuffRemains(E.SunfireDebuff)and(aj or aI:DebuffRemains(E.SunfireDebuff)<a8)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=93402;return true elseif(aI:DebuffRefreshable(E.SunfireDebuff)or g:BuffRemains(E.EclipseSolar)<3 and am and aI:DebuffRemains(E.SunfireDebuff)<14 and E.SouloftheForest:IsAvailable())and aI:TimeToDie()>14-aD+aI:DebuffRemains(E.SunfireDebuff)and(aj or aI:DebuffRemains(E.SunfireDebuff)<a8)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aO(aI)if(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=1325727;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=325727;return true elseif(aI:DebuffDown(E.AdaptiveSwarmDebuff)and not E.AdaptiveSwarm:InFlight()or aI:DebuffStack(E.AdaptiveSwarmDebuff)<3 and aI:DebuffRemains(E.AdaptiveSwarmDebuff)<3)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aP(aI)if aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>(14+aD*2*aE(g:BuffUp(E.EclipseLunar))+aI:DebuffRemains(E.MoonfireDebuff))/(1+aE(E.TwinMoons:IsAvailable()))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=18921;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>(14+aD*2*aE(g:BuffUp(E.EclipseLunar))+aI:DebuffRemains(E.MoonfireDebuff))/(1+aE(E.TwinMoons:IsAvailable()))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>(14+aD*2*aE(g:BuffUp(E.EclipseLunar))+aI:DebuffRemains(E.MoonfireDebuff))/(1+aE(E.TwinMoons:IsAvailable()))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=8921;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>(14+aD*2*aE(g:BuffUp(E.EclipseLunar))+aI:DebuffRemains(E.MoonfireDebuff))/(1+aE(E.TwinMoons:IsAvailable()))and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aQ(aI)if aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>15 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=1202347;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>15 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>15 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=202347;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>15 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aR(aI)if aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=193402;return true elseif aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=93402;return true elseif aI:DebuffRefreshable(E.SunfireDebuff)and aI:TimeToDie()>16 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aS(aI)if aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>13.5 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=18921;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>13.5 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>13.5 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=8921;return true elseif aI:DebuffRefreshable(E.MoonfireDebuff)and aI:TimeToDie()>13.5 and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aT(aI)if aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16+aI:DebuffRemains(E.StellarFlareDebuff)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==f("mouseover"):GUID()and D.Balance.TargetSwap=="Mouseover"and aI:NPCID()~=118044 then ae=1202347;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16+aI:DebuffRemains(E.StellarFlareDebuff)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and D.Balance.TargetSwap=="AutoSwap"and aI:GUID()~=i:GUID()and not t and aI:NPCID()~=118044 then ae=9999;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16+aI:DebuffRemains(E.StellarFlareDebuff)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:GUID()==i:GUID()and aI:NPCID()~=118044 then af=202347;return true elseif aI:DebuffRefreshable(E.StellarFlareDebuff)and aI:TimeToDie()>16+aI:DebuffRemains(E.StellarFlareDebuff)and(aI:AffectingCombat()or aI:IsDummy()or aI:NPCID()==153285)and aI:NPCID()~=118044 then return true end end;local function aU()aj=g:BuffUp(E.EclipseSolar)or g:BuffUp(E.EclipseLunar)ak=g:BuffUp(E.EclipseSolar)and g:BuffUp(E.EclipseLunar)al=g:BuffUp(E.EclipseLunar)and g:BuffDown(E.EclipseSolar)am=g:BuffUp(E.EclipseSolar)and g:BuffDown(E.EclipseLunar)an=not aj and(E.Starfire:Count()==0 and E.Wrath:Count()>0 or g:IsCasting(E.Wrath))or am;ao=not aj and(E.Wrath:Count()==0 and E.Starfire:Count()>0 or g:IsCasting(E.Starfire))or al;ap=not aj and E.Wrath:Count()>0 and E.Starfire:Count()>0 end;local function aV(aW)local aX=0;local aY=g:AstralPowerP()if aW==E.Sunfire or aW==E.Moonfire then aX=2 elseif aW==E.StellarFlare or aW==E.Starfire then aX=8 elseif aW==E.Wrath or aW==E.FuryofElune then aX=6 elseif aW==E.ForceofNature or aW==E.HalfMoon then aX=20 elseif aW==E.NewMoon then aX=10 elseif aW==E.FullMoon then aX=40 end;if E.NaturesBalance:IsAvailable()then aX=aX+1 end;if aY+aX<g:AstralPowerMax()then return true else return false end end;local function aZ()K=0;K=K+aE(I:IsReady()or I:CooldownRemains()>0)K=K+aE(J:IsReady()or J:CooldownRemains()>0)*2;K=K+aE(F.InscrutableQuantumDevice:IsEquipped()or F.EmpyrealOrdinance:IsEquipped()or F.SoullettingRuby:IsEquipped())*4;a3=30*(1-0.15*aE(g:HasTier(28,4)))a4=50*(1-0.15*aE(g:HasTier(28,4)))a5=30+10*aE(az)if E.MoonkinForm:IsCastable()then if p(E.MoonkinForm)then af=24858;return"moonkin_form precombat"end end;if E.Wrath:IsCastable()and not g:IsCasting(E.Wrath)then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath precombat 2"end end;if E.Wrath:IsCastable()and(g:IsCasting(E.Wrath)and E.Wrath:Count()==2 or g:PrevGCD(1,E.Wrath)and E.Wrath:Count()==1)then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath precombat 4"end end;if E.Starfire:IsCastable()and not g:IsCasting(E.Starfire)and((not aw or ah~=3 or aB~=1 or not E.NaturesBalance:IsAvailable())and not g:HasTier(28,2))then if p(E.Starfire,nil,nil,not i:IsSpellInRange(E.Starfire))then af=194153;return"starfire precombat 6"end end;if E.Starsurge:IsReady()and(aw and ah==3 and aB==1 and not g:HasTier(28,2))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge precombat 8"end end end;local function s()if E.Moonfire:IsReady()and i:DebuffDown(E.MoonfireDebuff)then if p(E.Moonfire,nil,nil,not i:IsSpellInRange(E.Moonfire))then af=8921;return"moonfire opener 2"end end;if E.Sunfire:IsReady()and i:DebuffDown(E.SunfireDebuff)then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire opener 4"end end;if E.StellarFlare:IsReady()and i:DebuffDown(E.StellarFlareDebuff)then if p(E.StellarFlare,nil,nil,not i:IsSpellInRange(E.StellarFlare))then af=202347;return"stellar_flare opener 6"end end;if ah==3 and o()then if E.WarriorofElune:IsReady()then if p(E.WarriorofElune,nil)then af=202425;return"warrior_of_elune opener 8"end end;if E.ForceofNature:IsReady()then if p(E.ForceofNature,nil)then af=205636;return"force_of_nature opener 10"end end;if E.FuryofElune:IsReady()then if p(E.FuryofElune,nil,nil,not i:IsSpellInRange(E.FuryofElune))then af=202770;return"fury_of_elune opener 12"end end end;if ah==2 then if E.RavenousFrenzy:IsCastable()and o()then if p(E.RavenousFrenzy,nil,nil)then af=323546;return"ravenous_frenzy opener 14"end end end;if E.Incarnation:IsReady()and o()then if p(E.Incarnation,nil)then af=102560;return"ca_inc opener 16"end end;if E.Starsurge:IsReady()and g:PrevGCDP(1,E.Incarnation)then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge opener 18"end end;if ah==2 then if E.Wrath:IsCastable()and g:PrevGCDP(1,E.Starsurge)then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath opener 20"end end;if E.Wrath:IsCastable()and(g:PrevGCDP(1,E.Wrath)and g:PrevGCDP(2,E.Starsurge))then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath opener 22"end end;if E.Wrath:IsCastable()and(g:PrevGCDP(1,E.Wrath)and g:PrevGCDP(2,E.Wrath)and g:PrevGCDP(3,E.Starsurge))then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath opener 24"end end;if g:PrevGCDP(3,E.Wrath)and g:PrevGCDP(4,E.Starsurge)then ac=true end end;if ah==3 then if E.Starsurge:IsReady()and(g:PrevGCDP(1,E.Starsurge)and g:PrevGCDP(2,E.Incarnation))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge opener 26"end end;if E.ConvoketheSpirits:IsReady()and o()then if p(E.ConvoketheSpirits,nil,nil,not i:IsInRange(40))then af=323764;return"convoke_the_spirits opener 28"end end;if E.Starsurge:IsReady()then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge opener 30"end end;if E.ConvoketheSpirits:CooldownDown()and E.Incarnation:CooldownDown()and g:AstralPowerP()<30 then ac=true end end end;local function a_()if E.Starsurge:IsReady()and not aw then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge fallthru 2"end end;if E.Sunfire:IsCastable()then if aH(i)then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire fallthru 4"end end;if C.CastCycle(E.Sunfire,aA,aH,not i:IsSpellInRange(E.Sunfire))then return"sunfire fallthru 4"end end;if E.Moonfire:IsCastable()then if p(E.Moonfire,nil,nil,not i:IsSpellInRange(E.Moonfire))then af=8921;return"moonfire fallthru 6"end end end;local function b0()if E.AdaptiveSwarm:IsCastable()then if aJ(i)then if p(E.AdaptiveSwarm,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=325727;return"adaptive_swarm st 2"end end;if C.CastCycle(E.AdaptiveSwarm,aA,aJ,not i:IsSpellInRange(E.AdaptiveSwarm))then return"adaptive_swarm st 2"end end;if E.ConvoketheSpirits:IsCastable()and(o()and((N and E.Incarnation:CooldownDown()and not av or g:BuffUp(E.Incarnation)and(not av or az or ad>127 or ad<E.Incarnation:CooldownRemains()+10 or g:BuffRemains(E.Incarnation)>12))and((g:AstralPowerP()<=a5 and(g:BuffRemains(E.EclipseLunar)>10 or g:BuffRemains(E.EclipseSolar)>10)or g:BuffRemains(E.Incarnation)>5 and g:BuffRemains(E.Incarnation)<=12)and(not ax or not az or g:BuffRemains(E.TimewornDreambinderBuff)>E.ConvoketheSpirits:ExecuteTime())or aw)and(not aw or(g:BuffStack(E.BOATNatureBuff)==8 or g:BuffStack(E.BOATArcaneBuff)==8))or ad<10 and E.Incarnation:CooldownDown()))then if p(E.ConvoketheSpirits,nil,nil,not i:IsInRange(40))then af=323764;return"convoke_the_spirits st 4"end end;if E.Starsurge:IsReady()and(ax and(not(g:BuffRemains(E.TimewornDreambinderBuff)>E.Wrath:ExecuteTime()+0.1 and(ak or am or an)or g:BuffRemains(E.TimewornDreambinderBuff)>E.Starfire:ExecuteTime()+0.1 and(al or ao or ap)or g:BuffDown(E.TimewornDreambinderBuff))or(g:BuffUp(E.Incarnation)or N)and E.ConvoketheSpirits:CooldownUp()and ah==3 and(g:BuffRemains(E.EclipseLunar)>10 or g:BuffRemains(E.EclipseSolar)>10))and(ah~=1 or E.EmpowerBond:CooldownRemains()>8))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 6"end end;if E.Starsurge:IsReady()and(aw and((g:BuffStack(E.BOATNatureBuff)>2 or g:BuffStack(E.BOATArcaneBuff)>2)and E.Incarnation:CooldownRemains()>7 and E.ConvoketheSpirits:CooldownDown()or ah==3 and E.ConvoketheSpirits:CooldownRemains()<10 and aj and g:AstralPowerP()>20+30*aE(E.Incarnation:CooldownUp())))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 8"end end;S=(g:BuffRemains(E.RavenousFrenzyBuff)>5 or g:BuffDown(E.RavenousFrenzyBuff))and g:BuffDown(E.RavenousFrenzySHBuff)and g:BuffRemains(E.KindredEmpowermentEnergizeBuff)<a8 and(g:BuffRemains(E.EclipseSolar)>a8 or g:BuffRemains(E.EclipseLunar)>a8 or(g:BuffDown(E.EclipseLunar)or g:BuffDown(E.EclipseSolar))and not E.Solstice:IsAvailable())T=g:BuffDown(E.EclipseSolar)and g:BuffDown(E.EclipseLunar)and not E.Solstice:IsAvailable()and not ax;if E.Moonfire:IsCastable()and(aV(E.Moonfire)and S)then if aK(i)then if p(E.Moonfire,nil,nil,not i:IsSpellInRange(E.Moonfire))then af=8921;return"moonfire st 10"end end;if C.CastCycle(E.Moonfire,aA,aK,not i:IsSpellInRange(E.Moonfire))then return"moonfire st 10"end end;if E.Sunfire:IsCastable()and(aV(E.Sunfire)and S)then if aL(i)then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire st 12"end end;if C.CastCycle(E.Sunfire,aA,aL,not i:IsSpellInRange(E.Sunfire))then return"sunfire st 12"end end;if E.StellarFlare:IsCastable()and(aV(E.StellarFlare)and S)then if aM(i)then if p(E.StellarFlare,nil,nil,not i:IsSpellInRange(E.StellarFlare))then af=202347;return"stellar_flare opener 6"end end;if C.CastCycle(E.StellarFlare,aA,aM,not i:IsSpellInRange(E.StellarFlare))then return"stellar_flare st 14"end end;a6=ah==2 and not ay and not as and E.Berserking:CooldownUp()and E.RavenousFrenzy:CooldownUp()and g:BuffDown(E.Incarnation)and(g:AstralPowerP()>87 or g:BloodlustUp())if E.Moonfire:IsCastable()and(a6 and i:DebuffRemains(E.MoonfireDebuff)<20)then if p(E.Moonfire,nil,nil,not i:IsSpellInRange(E.Moonfire))then af=8921;return"moonfire st 16"end end;if E.Sunfire:IsCastable()and(a6 and i:DebuffRemains(E.SunfireDebuff)<19)then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire st 18"end end;if E.ForceofNature:IsCastable()and o()and aV(E.ForceofNature)then if p(E.ForceofNature,nil,nil,not i:IsInRange(45))then af=205636;return"force_of_nature st 20"end end;if E.EmpowerBond:IsCastable()and q and(E.Incarnation:CooldownRemains()+E.Incarnation:BaseDuration()+aE(av)*12>70 or g:BuffRemains(E.Incarnation)>8 or not o())then if p(E.EmpowerBond)then af=326647;return"empower_bond st 22"end end;_=g:AstralPowerP()>90-(2.5*g:BuffStack(E.FuryofElune)-2*aE(al))P=o()and(O and g:BuffDown(E.Incarnation)and(not g:HasTier(28,2)or al or ao)and((_ or ah==3 or ah==1 and E.EmpowerBond:CooldownUp()or ax)and i:DebuffRemains(E.SunfireDebuff)>8 and i:DebuffRemains(E.MoonfireDebuff)>9 and(i:DebuffRemains(E.StellarFlareDebuff)>10 or not E.StellarFlare:IsAvailable())and a0 and i:TimeToDie()>E.Incarnation:BaseDuration()*0.7 or g:BloodlustUp()and g:BloodlustRemains()<E.Incarnation:BaseDuration()+12*aE(av)or F.EmpyrealOrdinance:IsEquipped()and F.EmpyrealOrdinance:CooldownRemains()<167+5*aE(ay))and(ah~=3 or(N or E.ConvoketheSpirits:CooldownRemains()<15)and(not aw or g:AstralPowerP()<50 and E.ConvoketheSpirits:CooldownUp())or ad<E.ConvoketheSpirits:CooldownRemains())or ad<E.Incarnation:BaseDuration()+12*aE(av))if E.RavenousFrenzy:IsCastable()and q and(g:BuffRemains(E.Incarnation)>15 or E.Incarnation:BaseDuration()<27+aE(av)*12 and P)then if p(E.RavenousFrenzy,nil,nil)then af=323546;return"ravenous_frenzy st 24"end end;if o()then if E.CelestialAlignment:IsCastable()and(P and(E.Incarnation:BaseDuration()>=27+aE(av)*12 or ah~=2)or g:BuffUp(E.RavenousFrenzyBuff)and g:BuffRemains(E.RavenousFrenzyBuff)<9+ar+aE(g:BloodlustDown()and not E.Starlord:IsAvailable()))then if p(E.CelestialAlignment,nil)then af=102560;return"celestial_alignment st 26"end end;if E.Incarnation:IsCastable()and P then if p(E.Incarnation,nil)then af=102560;return"incarnation st 28"end end end;U=E.Incarnation:CooldownRemains()>10 or not N and ah==3 or not o()if E.FuryofElune:IsCastable()and o()and(aj and(g:AstralPowerP()<92-g:BuffStack(E.FuryofElune)*5 or g:BuffUp(E.RavenousFrenzyBuff))and(a9<240 or g:BuffRemains(E.Incarnation)>8)and U and(ah~=4 or i:DebuffUp(E.AdaptiveSwarmDebuff))and(ah~=2 or g:BuffRemains(E.RavenousFrenzyBuff)<9-4*aE(ay)and g:BuffUp(E.RavenousFrenzyBuff)or g:BuffDown(E.RavenousFrenzyBuff))and(ah~=1 or E.EmpowerBond:CooldownRemains()>20)and i:TimeToDie()>5 or ad<10)then if p(E.FuryofElune,nil,nil,not i:IsSpellInRange(E.FuryofElune))then af=202770;return"fury_of_elune st 30"end end;if E.Starfall:IsReady()and(g:BuffUp(E.OnethsPerceptionBuff)and g:BuffRefreshable(E.StarfallBuff))then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall st 32"end end;a7=ah==3 and av and a9+g:AstralPowerP()+3>=300 and N and E.ConvoketheSpirits:CooldownRemains()<g:AstralPowerP()/30*g:GCD()and o()and aj and g:AstralPowerP()>a5 and E.Incarnation:CooldownRemains()>5;if E.Starfall:IsReady()and((E.StellarDrift:IsAvailable()or g:HasTier(28,4))and not E.Starlord:IsAvailable()and g:BuffRefreshable(E.StarfallBuff)and not ax and(a9>=250 and g:BuffDown(E.Incarnation)and(_ or g:BuffUp(E.KindredEmpowermentEnergizeBuff)or a7)or ah==4 and E.StellarDrift:IsAvailable()and(i:DebuffRemains(E.AdaptiveSwarmDebuff)>8 or E.AdaptiveSwarm:InFlight()))and(E.Incarnation:CooldownRemains()>10 or E.ConvoketheSpirits:CooldownRemains()>10))then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall st 34"end end;if E.Starsurge:IsReady()and a7 then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 36"end end;if(E.NewMoon:IsCastable()or g:IsCasting(E.FullMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.NewMoon)and(aV(E.NewMoon)and(E.NewMoon:Charges()==2 and E.NewMoon:Recharge()<5 or E.NewMoon:Charges()==3))then if p(E.NewMoon,nil,nil,not i:IsSpellInRange(E.NewMoon))then af=274281;return"new_moon st 38"end end;if(E.HalfMoon:IsCastable()or g:IsCasting(E.NewMoon)and E.HalfMoon:Charges()==2)and not g:IsCasting(E.HalfMoon)and(aV(E.HalfMoon)and(E.HalfMoon:Charges()==2 and E.HalfMoon:Recharge()<5 or E.HalfMoon:Charges()==3)and(g:BuffRemains(E.EclipseLunar)>E.HalfMoon:ExecuteTime()or g:BuffRemains(E.EclipseSolar)>E.HalfMoon:ExecuteTime()))then if p(E.HalfMoon,nil,nil,not i:IsSpellInRange(E.HalfMoon))then af=274281;return"half_moon st 40"end end;if(E.FullMoon:IsCastable()or g:IsCasting(E.HlafMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.FullMoon)and(aV(E.FullMoon)and(E.FullMoon:Charges()==2 and E.FullMoon:Recharge()<5 or E.FullMoon:Charges()==3)and(g:BuffRemains(E.EclipseLunar)>E.FullMoon:ExecuteTime()or g:BuffRemains(E.EclipseSolar)>E.FullMoon:ExecuteTime()))then if p(E.FullMoon,nil,nil,not i:IsSpellInRange(E.FullMoon))then af=274281;return"full_moon st 42"end end;if E.Starsurge:IsReady()and(aj and(g:BuffUp(E.OnethsClearVisionBuff)or g:BuffUp(E.KindredEmpowermentEnergizeBuff)or g:BuffUp(E.Incarnation)and(ah~=1 or E.EmpowerBond:CooldownRemains()>5 or g:BuffRemains(E.Incarnation)<g:GCD()*z(g:AstralPowerP()/a3))and(ah~=2 or g:BuffRemains(E.RavenousFrenzyBuff)<g:GCD()*A((g:AstralPowerP()+40*aE(E.FuryofElune:IsAvailable()))/a3)+3*aE(E.NewMoon:IsAvailable())and not ay and g:BuffUp(E.RavenousFrenzyBuff)or g:BuffUp(E.RavenousFrenzySHBuff)or(g:BuffRemains(E.RavenousFrenzyBuff)<E.Starfire:ExecuteTime()and g:SpellHaste()<0.4 or g:BuffRemains(E.RavenousFrenzyBuff)<E.Wrath:ExecuteTime()or a9>=210 and(g:AstralPowerP()>a3*2-5 or g:BuffRemains(E.RavenousFrenzyBuff)>2)and g:BuffRemains(E.RavenousFrenzyBuff)<6 or a1 and F.InscrutableQuantumDevice:IsEquippedAndReady())and g:BuffUp(E.RavenousFrenzyBuff)or g:BuffDown(E.RavenousFrenzyBuff)and E.RavenousFrenzy:CooldownDown())or _ or ad<(g:GCD()+0.5)*A(g:AstralPowerP()/a3)))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 44"end end;if E.Starsurge:IsReady()and(E.Starlord:IsAvailable()and not ax and(g:BuffUp(E.StarlordBuff)or g:AstralPowerP()>90)and g:BuffStack(E.StarlordBuff)<3 and(g:BuffUp(E.EclipseSolar)or g:BuffUp(E.EclipseLunar))and a9<270 and(E.Incarnation:CooldownRemains()>10 or not N and ah==3))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 46"end end;Z=aE(al)*8/E.Starfire:ExecuteTime()+aE(not al)*(6+aE(E.SouloftheForest:IsAvailable())*3)/E.Wrath:ExecuteTime()+0.45/g:SpellHaste()+0.5*aE(E.NaturesBalance:IsAvailable())if E.Starsurge:IsReady()and(not ax and(a9<270 or a9<250 and E.StellarDrift:IsAvailable())and(am and g:AstralPowerP()+Z*g:BuffRemains(E.EclipseSolar)+aa*2.5>80 or al and g:AstralPowerP()+Z*g:BuffRemains(E.EclipseLunar)+aa*2.5>90)and g:BuffDown(E.OnethsPerceptionBuff)and not E.Starlord:IsAvailable()and(E.Incarnation:CooldownRemains()>7 or E.ThrillSeeker:SoulbindEnabled()and g:BuffStack(E.ThrillSeekerBuff)<33-aE(ay)*2 and ad>100 and ad<200 or not o())and(ah~=1 or E.EmpowerBond:CooldownRemains()>2))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge st 48"end end;if(E.NewMoon:IsCastable()or g:IsCasting(E.FullMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.NewMoon)and(aV(E.NewMoon)and U and(g:BuffRemains(E.EclipseLunar)>E.NewMoon:ExecuteTime()or g:BuffRemains(E.EclipseSolar)>E.NewMoon:ExecuteTime()))then if p(E.NewMoon,nil,nil,not i:IsSpellInRange(E.NewMoon))then af=274281;return"new_moon st 50"end end;if(E.HalfMoon:IsCastable()or g:IsCasting(E.NewMoon)and E.HalfMoon:Charges()==2)and not g:IsCasting(E.HalfMoon)and(aV(E.HalfMoon)and U and(g:BuffRemains(E.EclipseLunar)>E.HalfMoon:ExecuteTime()or g:BuffRemains(E.EclipseSolar)>E.HalfMoon:ExecuteTime())and(g:BuffUp(E.Incarnation)or a9<=210)and(ah~=2 or g:BuffRemains(E.RavenousFrenzyBuff)<5-2*aE(ay)and g:BuffUp(E.RavenousFrenzyBuff)or g:BuffDown(E.RavenousFrenzyBuff))and(not ax or E.HalfMoon:ExecuteTime()<g:BuffRemains(E.TimewornDreambinderBuff)or g:BuffDown(E.TimewornDreambinderBuff)))then if p(E.HalfMoon,nil,nil,not i:IsSpellInRange(E.HalfMoon))then af=274281;return"half_moon st 52"end end;if(E.FullMoon:IsCastable()or g:IsCasting(E.HlafMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.FullMoon)and(aV(E.FullMoon)and U and(g:BuffRemains(E.EclipseLunar)>E.FullMoon:ExecuteTime()or g:BuffRemains(E.EclipseSolar)>E.FullMoon:ExecuteTime())and(g:BuffUp(E.Incarnation)or a9<=210)and(ah~=1 or g:BuffUp(E.KindredEmpowermentEnergizeBuff))and(ah~=2 or g:BuffRemains(E.RavenousFrenzyBuff)<5 and g:BuffUp(E.RavenousFrenzyBuff)and not ay or g:BuffDown(E.RavenousFrenzyBuff))and(not ax or E.FullMoon:ExecuteTime()<g:BuffRemains(E.TimewornDreambinderBuff)or g:BuffDown(E.TimewornDreambinderBuff)))then if p(E.FullMoon,nil,nil,not i:IsSpellInRange(E.FullMoon))then af=274281;return"full_moon st 54"end end;if E.WarriorofElune:IsCastable()then if p(E.WarriorofElune,nil)then af=202425;return"warrior_of_elune st 56"end end;if E.Starfire:IsCastable()and(al and g:BuffDown(E.RavenousFrenzyBuff)or ao or(ap or g:BuffRemains(E.Incarnation)<E.Wrath:ExecuteTime()and g:BuffUp(E.Incarnation))and(not g:HasTier(28,2)or av and a9<210 and E.Incarnation:CooldownRemains()>17 and(ah~=3 or E.ConvoketheSpirits:CooldownRemains()>17)and(g:Race()~="Troll"or E.Berserking:CooldownRemains()>17))or aj and(g:BuffUp(E.WarriorofElune)or g:SpellHaste()<0.45 and(ah~=2 or g:BuffDown(E.RavenousFrenzyBuff))or ah==2 and g:SpellHaste()<0.4))then if p(E.Starfire,nil,nil,not i:IsSpellInRange(E.Starfire))then af=194153;return"starfire st 58"end end;if E.Wrath:IsCastable()then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath st 60"end end;if true then local ShouldReturn=a_()if ShouldReturn then return ShouldReturn end end end;local function b1()V=ax and(g:BuffRemains(E.TimewornDreambinderBuff)<a8+0.1 or g:BuffRemains(E.TimewornDreambinderBuff)<E.Starfire:ExecuteTime()+0.1 and(al or ao or ap))and g:BuffUp(E.TimewornDreambinderBuff)W=not am and aD>7-aE(E.SouloftheForest:IsAvailable())*2+aE(ak)and not av and not au;if E.ConvoketheSpirits:IsCastable()and(o()and((N and E.Incarnation:CooldownDown()and not av or g:BuffUp(E.Incarnation)and(not av or az or ad>127 or ad<E.Incarnation:CooldownRemains()+10 or g:BuffRemains(E.Incarnation)>12))and(((g:AstralPowerP()<=a5 or aD>3)and(g:BuffRemains(E.EclipseLunar)>10 or g:BuffRemains(E.EclipseSolar)>10)or g:BuffRemains(E.Incarnation)>5 and g:BuffRemains(E.Incarnation)<=12)and(not E.StellarDrift:IsAvailable()or g:BuffRemains(E.StarfallBuff)<1.5-0.5*aE(az)or g:BuffRemains(E.Incarnation)<g:BuffRemains(E.StarfallBuff)+5 and g:BuffUp(E.Incarnation))and(not ax or not az or g:BuffRemains(E.TimewornDreambinderBuff)>E.ConvoketheSpirits:ExecuteTime())or aw)and(not aw or(g:BuffStack(E.BOATNatureBuff)==8 or g:BuffStack(E.BOATArcaneBuff)==8))or ad<10 and E.Incarnation:CooldownDown()))then if p(E.ConvoketheSpirits,nil,nil,not i:IsInRange(40))then af=323764;return"convoke_the_spirits aoe 2"end end;if E.Sunfire:IsCastable()then if aN(i)then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire aoe 4"end end;if C.CastCycle(E.Sunfire,aA,aN,not i:IsSpellInRange(E.Sunfire))then return"sunfire aoe 4"end end;if E.Sunfire:IsCastable()and D.Commons.Enabled.Trinkets and(a1 and F.InscrutableQuantumDevice:IsEquippedAndReady()and aV(E.Sunfire))then if p(E.Sunfire,nil,nil,not i:IsSpellInRange(E.Sunfire))then af=93402;return"sunfire aoe 6"end end;if E.Starfall:IsReady()and(not E.StellarDrift:IsAvailable()and(not g:HasTier(28,4)or aj or aD>3)and(g:BuffRefreshable(E.StarfallBuff)and(aB<3 or not ax)or E.SouloftheForest:IsAvailable()and g:BuffRemains(E.EclipseSolar)<3 and am and g:BuffRemains(E.StarfallBuff)<7 and aB>=4)and(not at or d.CombatTime()%45>g:BuffRemains(E.StarfallBuff)+2)and i:TimeToDie()>5)then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall aoe 8"end end;if E.Starfall:IsReady()and(E.StellarDrift:IsAvailable()and g:BuffRefreshable(E.StarfallBuff)and(not g:HasTier(28,4)or aj or aD>3)and(not at or d.CombatTime()%45>4)and i:TimeToDie()>3)then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall aoe 10"end end;if E.Starfall:IsReady()and(ax and aB>=3 and(g:BuffDown(E.TimewornDreambinderBuff)and g:BuffRefreshable(E.StarfallBuff)or V and(g:BuffRemains(E.StarfallBuff)<3 or aB>2 and E.StellarDrift:IsAvailable()and g:BuffRemains(E.StarfallBuff)<5)))then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall aoe 12"end end;X=g:AstralPowerP()>80*(1-aE(g:HasTier(28,2))*0.2)*(1-g:BuffStack(E.TimewornDreambinderBuff)*0.1)-g:BuffRemains(E.StarfallBuff)*3/g:SpellHaste()*aE(not E.StellarDrift:IsAvailable())-E.Starfall:CooldownRemains()*3/g:SpellHaste()*aE(E.StellarDrift:IsAvailable())-g:BuffRemains(E.FuryofElune)*5 and(g:BuffUp(E.StarfallBuff)or E.Starfall:CooldownDown())if E.Starsurge:IsReady()and(V and X and not W or(g:BuffStack(E.BOATNatureBuff)>3 or g:BuffStack(E.BOATArcaneBuff)>3)and aB<4 and X)then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge aoe 14"end end;if E.AdaptiveSwarm:IsCastable()then if aO(i)then if p(E.AdaptiveSwarm,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=325727;return"adaptive_swarm aoe 16"end end;if C.CastCycle(E.AdaptiveSwarm,aA,aO,not i:IsSpellInRange(E.AdaptiveSwarm))then return"adaptive_swarm aoe 16"end end;if E.Moonfire:IsCastable()and(g:AstralPowerP()>a4-g:BuffRemains(E.StarfallBuff)*6 and(aV(E.Moonfire)or W or not aj)and(E.Incarnation:CooldownUp()and aj and o()and(N or E.ConvoketheSpirits:CooldownUp()or ah~=3)or aD<(8-aE(g:BuffUp(E.EclipseLunar))*3)*(1+aE(E.TwinMoons:IsAvailable()))and not ao and(E.Incarnation:CooldownDown()or not o())or(am or g:BuffUp(E.EclipseLunar)and not E.SouloftheForest:IsAvailable())and aD<10*(1+aE(E.TwinMoons:IsAvailable())))and(ah~=1 or g:BuffDown(E.KindredEmpowermentEnergizeBuff)or am)and g:BuffDown(E.RavenousFrenzySHBuff))then if aP(i)then if p(E.Moonfire,nil,nil,not i:IsSpellInRange(E.Moonfire))then af=8921;return"moonfire aoe 18"end end;if C.CastCycle(E.Moonfire,aA,aP,not i:IsSpellInRange(E.Moonfire))then return"moonfire aoe 18"end end;if E.ForceofNature:IsCastable()and o()and(aV(E.ForceofNature)or W)then if p(E.ForceofNature,nil)then af=205636;return"force_of_nature aoe 20"end end;Q=o()and(O and(g:BuffUp(E.StarfallBuff)or E.StellarDrift:IsAvailable()or ah==3)and i:DebuffUp(E.MoonfireDebuff)and(g:BuffDown(E.SolsticeBuff)and g:BuffDown(E.Incarnation)and(not E.FuryofElune:IsAvailable()or E.Incarnation:BaseDuration()>E.FuryofElune:CooldownRemains()+8)and(not g:HasTier(28,2)or al or ao)and a0 and(ah~=3 or N or E.ConvoketheSpirits:CooldownRemains()<15)and i:TimeToDie()>E.Incarnation:BaseDuration()*0.7)or ad<E.Incarnation:BaseDuration()+12*aE(av))if E.RavenousFrenzy:IsCastable()and(g:BuffRemains(E.Incarnation)>15 or E.Incarnation:BaseDuration()+12*aE(av)<26 and Q)then if p(E.RavenousFrenzy,nil,nil)then af=323546;return"ravenous_frenzy aoe 22"end end;if o()then if E.CelestialAlignment:IsCastable()and(Q and(ah~=2 or not ay or av or E.Incarnation:BaseDuration()>=26)or g:BuffUp(E.RavenousFrenzyBuff)and g:BuffRemains(E.RavenousFrenzyBuff)<15.5)then if p(E.CelestialAlignment,nil)then af=102560;return"celestial_alignment aoe 24"end end;if E.Incarnation:IsCastable()and Q then if p(E.Incarnation,nil)then af=102560;return"incarnation aoe 26"end end end;if E.EmpowerBond:IsCastable()and q and(E.Incarnation:CooldownRemains()+E.Incarnation:BaseDuration()+aE(av)*12>70 or g:BuffRemains(E.Incarnation)>8 or not o())then if p(E.KindredSpirits,nil,nil)then af=326434;return"kindred_spirits aoe 28"end end;if E.StellarFlare:IsCastable()and(aD<4 and aV(E.StellarFlare)and(g:BuffRemains(E.Incarnation)>10 or g:BuffDown(E.Incarnation)))then if aQ(i)then if p(E.StellarFlare,nil,nil,not i:IsSpellInRange(E.StellarFlare))then af=202347;return"stellar_flare aoe 30"end end;if C.CastCycle(E.StellarFlare,aA,aQ,not i:IsSpellInRange(E.StellarFlare))then return"stellar_flare aoe 30"end end;if E.FuryofElune:IsCastable()and(aj and(aV(E.FuryofElune)or not av)and(a9<250 or g:BuffRemains(E.Incarnation)>8)and(i:DebuffUp(E.AdaptiveSwarmDebuff)or ah~=4 or aD>2)and(g:BuffRemains(E.RavenousFrenzyBuff)<9-4*aE(ay)and g:BuffUp(E.RavenousFrenzyBuff)or g:BuffDown(E.RavenousFrenzyBuff))and(E.Incarnation:CooldownDown()or g:BuffStack(E.ThrillSeekerBuff)<15 and ad<200 and ad>100 or not E.ThrillSeeker:SoulbindEnabled())and(E.ThrillSeeker:SoulbindEnabled()or E.Incarnation:CooldownRemains()>30)and i:TimeToDie()>5 or ad<10)then if p(E.FuryofElune,nil,nil,not i:IsSpellInRange(E.FuryofElune))then af=202770;return"fury_of_elune aoe 32"end end;if E.Starfall:IsReady()and(g:BuffUp(E.OnethsPerceptionBuff)and(g:BuffRefreshable(E.StarfallBuff)or g:AstralPowerP()>90))then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall aoe 34"end end;if E.Starfall:IsReady()and(ah==3 and not E.StellarDrift:IsAvailable()and(N or E.Incarnation:CooldownUp()or g:BuffUp(E.Incarnation))and E.ConvoketheSpirits:CooldownRemains()<a8*A(g:AstralPowerP()/a4)and g:BuffRemains(E.StarfallBuff)<4 and o())then if p(E.Starfall,nil,nil,not i:IsInRange(45))then af=191034;return"starfall aoe 36"end end;if E.Starsurge:IsReady()and(ah==3 and(N or E.Incarnation:CooldownUp()or g:BuffUp(E.Incarnation))and E.ConvoketheSpirits:CooldownRemains()<5 and X and aj and not W and o())then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge aoe 38"end end;if E.Starsurge:IsReady()and(g:BuffUp(E.OnethsClearVisionBuff)or(not aV(E.Starfire)and not W or(g:BuffRemains(E.Incarnation)<5 and g:BuffUp(E.Incarnation)or(g:BuffRemains(E.Incarnation)<a8*A(g:AstralPowerP()/a3)and g:BuffUp(E.Incarnation)or g:BuffRemains(E.RavenousFrenzySHBuff)<a8*A(g:AstralPowerP()/a3)and g:BuffUp(E.RavenousFrenzySHBuff))and ah==2)and(aB<3 or X))and not W and(not ax or aB<3))then if p(E.Starsurge,nil,nil,not i:IsSpellInRange(E.Starsurge))then af=78674;return"starsurge aoe 40"end end;if(E.NewMoon:IsCastable()or g:IsCasting(E.FullMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.NewMoon)and((g:BuffRemains(E.EclipseSolar)>E.NewMoon:ExecuteTime()or E.NewMoon:Charges()==2 and E.NewMoon:Recharge()<5 or E.NewMoon:Charges()==3)and aV(E.NewMoon))then if p(E.NewMoon,nil,nil,not i:IsSpellInRange(E.NewMoon))then af=274281;return"new_moon aoe 42"end end;if(E.HalfMoon:IsCastable()or g:IsCasting(E.NewMoon)and E.HalfMoon:Charges()==2)and not g:IsCasting(E.HalfMoon)and((g:BuffRemains(E.EclipseSolar)>E.HalfMoon:ExecuteTime()or E.HalfMoon:Charges()==2 and E.HalfMoon:Recharge()<5 or E.HalfMoon:Charges()==3)and aV(E.HalfMoon)and(g:BuffRemains(E.RavenousFrenzyBuff)<5 and g:BuffUp(E.RavenousFrenzyBuff)and not ay or g:BuffDown(E.RavenousFrenzyBuff)))then if p(E.HalfMoon,nil,nil,not i:IsSpellInRange(E.HalfMoon))then af=274281;return"half_moon aoe 44"end end;if(E.FullMoon:IsCastable()or g:IsCasting(E.HlafMoon)and E.FullMoon:Charges()==2)and not g:IsCasting(E.FullMoon)and((g:BuffRemains(E.EclipseSolar)>E.FullMoon:ExecuteTime()and(E.Incarnation:CooldownRemains()>50 or E.ConvoketheSpirits:CooldownRemains()>50)or E.FullMoon:Charges()==2 and E.FullMoon:Recharge()<5 or E.FullMoon:Charges()==3)and aV(E.FullMoon)and(g:BuffRemains(E.RavenousFrenzyBuff)<5 and g:BuffUp(E.RavenousFrenzyBuff)and not ay or g:BuffDown(E.RavenousFrenzyBuff)))then if p(E.FullMoon,nil,nil,not i:IsSpellInRange(E.FullMoon))then af=274281;return"full_moon aoe 46"end end;if E.WarriorofElune:IsCastable()then if p(E.WarriorofElune,nil)then af=202425;return"warrior_of_elune aoe 48"end end;Y=aD>4+z(g:MasteryPct()/20)if E.Wrath:IsCastable()and(g:BuffDown(E.RavenousFrenzyBuff)and g:BuffDown(E.RavenousFrenzySHBuff)and not E.SouloftheForest:IsAvailable()and aD<3 and g:BuffRemains(E.EclipseSolar)>E.Wrath:ExecuteTime()and ad>g:BuffRemains(E.Incarnation)+12*aE(av))then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath aoe 49"end end;a2=1/g:SpellHaste()<2-0.2*(aD-1)*(1+aE(E.SouloftheForest:IsAvailable())*1.5)+0.15*g:BuffRemains(E.RavenousFrenzyBuff)if E.Wrath:IsCastable()and((an or ap and M)and(i:TimeToDie()>4 or E.Wrath:Count()==2 or ad<10)or g:BuffRemains(E.EclipseSolar)<E.Starfire:ExecuteTime()and g:BuffUp(E.EclipseSolar)or am and not Y or g:BuffRemains(E.Incarnation)<E.Starfire:ExecuteTime()and not M and g:BuffRemains(E.Incarnation)<E.Wrath:ExecuteTime()and g:BuffUp(E.Incarnation)or g:BuffUp(E.RavenousFrenzyBuff)and a2 or not M and g:BuffRemains(E.Incarnation)>E.Wrath:ExecuteTime())then if p(E.Wrath,nil,nil,not i:IsSpellInRange(E.Wrath))then af=190984;return"wrath aoe 50"end end;if E.Starfire:IsCastable()then if p(E.Starfire,nil,nil,not i:IsSpellInRange(E.Starfire))then af=194153;return"starfire aoe 52"end end;if true then local ShouldReturn=a_()if ShouldReturn then return ShouldReturn end end end;local function b2()Opener1=HeroRotationCharDB.Toggles[6]q=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[5]t=HeroRotationCharDB.Toggles[12]u=not HeroRotationCharDB.Toggles[15]v=HeroRotationCharDB.Toggles[60]end;local function b3()if n()and D.Commons.AoeMode=="Conservative"then aD=i:GetEnemiesInSplashRangeCount(8)EnemiesCount10ySplash=i:GetEnemiesInSplashRangeCount(15)elseif n()and D.Commons.AoeMode=="Aggresive"then local b4=0;for b5=1,20 do local b6="nameplate"..b5;if UnitExists(b6)then if UnitCanAttack("player",b6)then if UnitCanAttack("player",b6)and UnitAffectingCombat("target")and IsItemInRange(32698,b6)and UnitDetailedThreatSituation("player",b6)~=nil or f(b6):IsDummy()or string.find(UnitGUID(b6),153285)or string.find(UnitGUID(b6),31146)or string.find(UnitGUID(b6),176581)or string.find(UnitGUID(b6),179124)or string.find(UnitGUID(b6),179010)or string.find(UnitGUID(b6),180323)or string.find(UnitGUID(b6),179010)or string.find(UnitGUID(b6),179942)or string.find(UnitGUID(b6),176521)or string.find(UnitGUID(b6),177594)or string.find(UnitGUID(b6),177117)or string.find(UnitGUID(b6),176581)or string.find(UnitGUID(b6),180840)or string.find(UnitGUID(b6),176605)or UnitName(b6)=="Glacial Spike"or string.find(UnitGUID(b6),180473)or string.find(UnitGUID(b6),180474)or string.find(UnitGUID(b6),176929)or string.find(UnitGUID(b6),176920)or string.find(UnitGUID(b6),177154)or string.find(UnitGUID(b6),177787)or string.find(UnitGUID(b6),177889)or string.find(UnitGUID(b6),177891)or string.find(UnitGUID(b6),177892)or string.find(UnitGUID(b6),168326)or string.find(UnitGUID(b6),182778)or string.find(UnitGUID(b6),183945)then b4=b4+1 end end end end;aD=b4;EnemiesCount10ySplash=b4 end;local b7=0;for b8=1,20 do local b6="nameplate"..b8;if UnitExists(b6)then if UnitCanAttack("player",b6)then if UnitCanAttack("player",b6)and UnitAffectingCombat("target")and IsItemInRange(32698,b6)and UnitDetailedThreatSituation("player",b6)~=nil and f(b6):TimeToDie()>=12 or f(b6):IsDummy()or string.find(UnitGUID(b6),153285)or string.find(UnitGUID(b6),31146)or string.find(UnitGUID(b6),176581)or string.find(UnitGUID(b6),179124)or string.find(UnitGUID(b6),179010)or string.find(UnitGUID(b6),180323)or string.find(UnitGUID(b6),179010)or string.find(UnitGUID(b6),179942)or string.find(UnitGUID(b6),176521)or string.find(UnitGUID(b6),177594)or string.find(UnitGUID(b6),177117)or string.find(UnitGUID(b6),176581)or string.find(UnitGUID(b6),180840)or string.find(UnitGUID(b6),176605)or UnitName(b6)=="Glacial Spike"or string.find(UnitGUID(b6),180473)or string.find(UnitGUID(b6),180474)or string.find(UnitGUID(b6),176929)or string.find(UnitGUID(b6),176920)or string.find(UnitGUID(b6),177154)or string.find(UnitGUID(b6),177787)or string.find(UnitGUID(b6),177889)or string.find(UnitGUID(b6),177891)or string.find(UnitGUID(b6),177892)or string.find(UnitGUID(b6),168326)or string.find(UnitGUID(b6),182778)or string.find(UnitGUID(b6),183945)then b7=b7+1 end end end end;aA=g:GetEnemiesInRange(40)if n()then aB=#aA;aD=i:GetEnemiesInSplashRangeCount(8)else aB=1;aD=1 end;if not BotOn then ae=0;af=0 end;if ae>0 then ae=0 end;if af>0 then af=0 end;ShouldReturn=b2()a8=g:GCD()+0.5;local b9=GetInventoryItemID("player",13)local ba=GetInventoryItemID("player",14)ad=d.FightRemains(aC,false)a9=0;if av then a9=select(16,g:BuffInfo(E.PAPBuff,false,true))or 0 end;if E.FuryofElune:IsAvailable()then ab=E.FuryofElune:CooldownRemains()-51;if ab<0 then ab=0 end;aa=ab*2 else ab=0;aa=0 end;if g:IsChanneling(E.ConvoketheSpirits)then if p(E.Pool,nil)then af=99999;return"channeling 4"end end;if g:IsChanneling(j(355321))then if p(E.Pool,nil)then af=99999;return"Trinket Channel"end end;if E.MoonkinForm:IsCastable()and D.Balance.ShowMoonkinFormOOC then if p(E.MoonkinForm)then af=24858;return"moonkin_form ooc"end end;if C.TargetIsValid()then aU()K=0;K=K+aE(I:IsReady()or I:CooldownRemains()>0)K=K+aE(J:IsReady()or J:CooldownRemains()>0)*2;K=K+aE(F.InscrutableQuantumDevice:IsEquipped()or F.EmpyrealOrdinance:IsEquipped()or F.SoullettingRuby:IsEquipped())*4;a3=30*(1-0.15*aE(g:HasTier(28,4)))a4=50*(1-0.15*aE(g:HasTier(28,4)))a5=30+10*aE(az)if not g:AffectingCombat()then local ShouldReturn=aZ()if ShouldReturn then return ShouldReturn end end;L=aB>1 and(not E.Starlord:IsAvailable()or E.StellarDrift:IsAvailable())or aB>2;M=aD>1;if d.CombatTime()>20 then ac=true end;if not ac and(ah==2 or ah==3)then local ShouldReturn=s()if ShouldReturn then return ShouldReturn end end;if E.Berserking:IsCastable()and o()and((ah~=3 or not E.ConvoketheSpirits:CooldownUp()or not aw)and g:BuffRemains(E.Incarnation)>15 and g:BuffRemains(E.RavenousFrenzyBuff)and ah~=2 or ah==2 and g:BuffUp(E.Incarnation)and g:BuffUp(E.RavenousFrenzyBuff)and(g:BuffRemains(E.RavenousFrenzyBuff)<12-4*aE(ay)or g:BuffRemains(E.Incarnation)<11 or 1/g:SpellHaste()<1.6))then if p(E.Berserking,nil)then af=26297;return"berserking main 2"end end;if F.PotionofSpectralIntellect:IsReady()and D.Commons.Enabled.Potions and(g:BuffRemains(E.Incarnation)>15 and(not ay or g:BuffRemains(E.RavenousFrenzyBuff)<19 and g:BuffUp(E.RavenousFrenzyBuff))or ad<25)then if p(F.PotionofSpectralIntellect,nil,nil)then af=50;return"potion 4"end end;if ah==3 then local bb=A((ad-15-E.Incarnation:CooldownRemains())/180)local bc=A((ad-15-E.ConvoketheSpirits:CooldownRemains())/180)N=bb>bc and aD==1 and(E.Incarnation:CooldownDown()or E.ConvoketheSpirits:CooldownDown())or E.Incarnation:CooldownRemains()>ad or az and E.Incarnation:CooldownRemains()>30 or E.ConvoketheSpirits:CooldownRemains()>ad-10 else N=true end;O=ad>15 and(F.EmpyrealOrdinance:IsEquipped()and(ah~=2 or F.EmpyrealOrdinance:CooldownRemains()<167+5*aE(ay))and F.EmpyrealOrdinance:CooldownDown()or F.SoullettingRuby:IsEquipped()and(ah~=3 or F.SoullettingRuby:CooldownRemains()<114)or(E.Berserking:CooldownUp()or g:Race()~="Troll"or ah==3)and(not E.FuryofElune:IsAvailable()or ah==2 and E.FuryofElune:CooldownRemains()<11+5*aE(ay)or ah~=2 and E.FuryofElune:CooldownRemains()<E.Incarnation:BaseDuration()+12*aE(av)-12)and(F.InscrutableQuantumDevice:IsEquipped()and F.InscrutableQuantumDevice:CooldownRemains()<5)or(F.ShadowedOrbofTorment:IsEquipped()and F.ShadowedOrbofTorment:CooldownRemains()>0 or((K==1 or K==3)and(I:IsReady()or I:CooldownRemains()>ad-10)or K==2 and(J:IsReady()or J:CooldownRemains()>ad-10)or K==0)))a0=not E.ThrillSeeker:SoulbindEnabled()or ad>200 or ad<25+40-g:BuffStack(E.ThrillSeekerBuff)*2 or g:BuffStack(E.ThrillSeekerBuff)>38-aE(ay)*2;if D.Commons.Enabled.TopTrinket or D.Commons.Enabled.BottomTrinket then if F.EmpyrealOrdinance:IsEquippedAndReady()and(E.Incarnation:CooldownRemains()<20 and E.ConvoketheSpirits:CooldownRemains()<20 and(a0 or g:BuffStack(E.ThrillSeekerBuff)>30+aE(ay)*3)or ad<37)then if F.EmpyrealOrdinance:ID()==b9 and D.Commons.Enabled.TopTrinket then af=24;return"top trinket EmpyrealOrdinance"elseif F.EmpyrealOrdinance:ID()==ba and D.Commons.Enabled.BottomTrinket then af=35;return"bot trinket EmpyrealOrdinance"end end;if F.SoullettingRuby:IsEquippedAndReady()and((E.Incarnation:CooldownRemains()<6 and ah~=2 and ah~=3 or ah==3 and E.ConvoketheSpirits:CooldownRemains()<6 and(N or E.Incarnation:CooldownRemains()<6)or ah==2 and(not ay and E.Incarnation:CooldownRemains()<6 or g:BuffRemains(E.RavenousFrenzyBuff)<10+5*aE(F.InstructorsDivineBell:IsEquipped())and g:BuffUp(E.RavenousFrenzyBuff))or ad<25 or F.EmpyrealOrdinance:IsEquipped()and F.EmpyrealOrdinance:CooldownRemains()>20)and not F.InscrutableQuantumDevice:IsEquipped()or F.InscrutableQuantumDevice:CooldownRemains()>20 or ad<20)then if F.SoullettingRuby:ID()==b9 and D.Commons.Enabled.TopTrinket then af=24;return"top trinket SoullettingRuby"elseif F.SoullettingRuby:ID()==ba and D.Commons.Enabled.BottomTrinket then af=35;return"bot trinket SoullettingRuby"end end;a1=g:BuffRemains(E.Incarnation)>15 and(not ay or g:BuffRemains(E.RavenousFrenzyBuff)<=15.5+3.5*aE(g:BloodlustUp())+(4.5-3.5*aE(g:BloodlustUp()))*aE(F.InstructorsDivineBell:IsEquipped())+4.5*aE(F.TheFirstSigil:IsEquipped()and F.TheFirstSigil:CooldownRemains()<=20)and g:BuffUp(E.RavenousFrenzyBuff))or ad<25 or F.EmpyrealOrdinance:IsEquipped()and not F.EmpyrealOrdinance:CooldownUp()if F.InscrutableQuantumDevice:IsEquippedAndReady()and a1 then if F.InscrutableQuantumDevice:ID()==b9 and D.Commons.Enabled.TopTrinket then af=24;return"top trinket InscrutableQuantumDevice"elseif F.InscrutableQuantumDevice:ID()==ba and D.Commons.Enabled.BottomTrinket then af=35;return"bot trinket InscrutableQuantumDevice"end end;if F.ShadowedOrbofTorment:IsEquippedAndReady()and((E.Incarnation:CooldownUp()and ah~=3 and a0 and(E.Berserking:CooldownUp()or g:Race()~="Troll")or ah==3 and E.ConvoketheSpirits:CooldownUp()and(N or E.Incarnation:CooldownUp()))and i:DebuffUp(E.SunfireDebuff)and(i:DebuffUp(E.StellarFlareDebuff)or not E.StellarFlare:IsAvailable()or aD>3)and i:DebuffUp(E.MoonfireDebuff)and(L or aw or g:AstralPowerP()>=90 or N or g:BloodlustUp())and not F.InscrutableQuantumDevice:IsEquipped()or F.InscrutableQuantumDevice:IsEquipped()and F.InscrutableQuantumDevice:CooldownRemains()>30 and g:BuffDown(E.Incarnation)or ad<40)then if F.ShadowedOrbofTorment:ID()==b9 and D.Commons.Enabled.TopTrinket then af=24;return"top trinket ShadowedOrbofTorment"elseif F.ShadowedOrbofTorment:ID()==ba and D.Commons.Enabled.BottomTrinket then af=35;return"bot trinket ShadowedOrbofTorment"end end;local bd=g:GetUseableTrinkets(G)if bd then if bd:ID()==GetInventoryItemID("player",13)and D.Commons.Enabled.TopTrinket then if m.Cast(bd,nil,nil)then af=24;return"top trinket 1"end elseif bd:ID()==GetInventoryItemID("player",14)and D.Commons.Enabled.BottomTrinket then if m.Cast(bd,nil,nil)then af=35;return"bot trinket 1"end end end else a1=false end;if L then local ShouldReturn=b1()if ShouldReturn then return ShouldReturn end end;if true then local ShouldReturn=b0()if ShouldReturn then return ShouldReturn end end end end;local function be()end;function ReturnSpell1()if af==0 then return 0 else return af end end;function ReturnSpellMO1()if ae==0 then return 0 else return ae end end;m.SetAPL(102,b3,be)