local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=f.Pet;local j=d.Spell;local k=d.Item;local l=HeroRotation;local m=l.AoEON;local n=l.CDsON;local o=l.Cast;local p=l.Commons.Everyone.num;local q=l.Commons.Everyone.bool;local r=f.MouseOver;local s=math.min;local t=l.Commons.Everyone;local u=l.Commons.Paladin;local v=g:GetEquipment()local w=v[13]and k(v[13])or k(0)local x=v[14]and k(v[14])or k(0)local y=GetInventoryItemID("player",13)local z=GetInventoryItemID("player",14)local A={General=l.GUISettings.General,Commons=l.GUISettings.APL.Paladin.Commons,Retribution=l.GUISettings.APL.Paladin.Retribution}local B=j.Paladin.Retribution;local C=k.Paladin.Retribution;local D={C.AlgetharPuzzleBox:ID(),C.ShadowedRazingAnnihilator:ID()}local E=HeroRotationCharDB.Toggles[175]local F=HeroRotationCharDB.Toggles[176]local G=HeroRotationCharDB.Toggles[177]local H=HeroRotationCharDB.Toggles[178]local I=HeroRotationCharDB.Toggles[179]local J=HeroRotationCharDB.Toggles[180]local K=HeroRotationCharDB.Toggles[181]local L=HeroRotationCharDB.Toggles[182]local M=HeroRotationCharDB.Toggles[5]local N=0;local O=0;local P;local Q;local R;local S=11111;local T=11111;local U;local V=0;local W=0;local X;local Y=B.FinalVerdict:IsLearned()and B.FinalVerdict or B.TemplarsVerdict;local Z=g:GetEquipment()local _=Z[13]and k(Z[13])or k(0)local a0=Z[14]and k(Z[14])or k(0)d:RegisterForEvent(function()Z=g:GetEquipment()_=Z[13]and k(Z[13])or k(0)a0=Z[14]and k(Z[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")d:RegisterForEvent(function()S=11111;T=11111 end,"PLAYER_REGEN_ENABLED")d:RegisterForEvent(function()Y=B.FinalVerdict:IsLearned()and B.FinalVerdict or B.TemplarsVerdict end,"SPELLS_CHANGED","LEARNED_SPELL_IN_TAB")local function a1()local a2=g:GCDRemains()local a3=s(B.CrusaderStrike:CooldownRemains(),B.BladeofJustice:CooldownRemains(),B.Judgment:CooldownRemains(),B.HammerofWrath:IsUsable()and B.HammerofWrath:CooldownRemains()or 10,B.WakeofAshes:CooldownRemains())if a2>a3 then return a2 end;return a3 end;local function a4()return g:BuffDown(B.RetributionAura)and g:BuffDown(B.DevotionAura)and g:BuffDown(B.ConcentrationAura)and g:BuffDown(B.CrusaderAura)end;local function a5()if B.ShieldofVengeance:IsCastable()then if o(B.ShieldofVengeance,nil)then N=184662;return"shield_of_vengeance precombat 6"end end;if Y:IsReady()and V>=4 and h:IsSpellInRange(Y)then if o(Y,nil,nil,not h:IsSpellInRange(Y))then N=383328;return"either verdict precombat 2"end end;if B.BladeofJustice:IsCastable()then if o(B.BladeofJustice,nil,nil,not h:IsSpellInRange(B.BladeofJustice))then N=184575;return"blade_of_justice precombat 4"end end;if B.Judgment:IsCastable()then if o(B.Judgment,nil,nil,not h:IsSpellInRange(B.Judgment))then N=275773;return"judgment precombat 6"end end;if B.HammerofWrath:IsReady()then if o(B.HammerofWrath,nil,nil,not h:IsSpellInRange(B.HammerofWrath))then N=24275;return"hammer_of_wrath precombat 8"end end;if B.CrusaderStrike:IsCastable()then if o(B.CrusaderStrike,nil,nil,not h:IsSpellInRange(B.CrusaderStrike))then N=35395;return"crusader_strike 10"end end end;local function a6()if A.Commons.Enabled.Potions and(g:BuffUp(B.AvengingWrathBuff)or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)==10 or T<25)then local a7=t.PotionSelected()if a7 and a7:IsReady()then if l.Cast(a7,nil,nil)then N=10;return"potion cooldowns 2"end end end;if B.LightsJudgment:IsCastable()then if o(B.LightsJudgment,nil,nil,not h:IsInRange(40))then N=255647;return"lights_judgment cooldowns 4"end end;if B.Fireblood:IsCastable()and(g:BuffUp(B.AvengingWrathBuff)or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)==10)then if o(B.Fireblood,nil)then N=265221;return"fireblood cooldowns 6"end end;local a8=g:GetUseableTrinkets(D)if(A.Commons.Enabled.TopTrinket or A.Commons.Enabled.BottomTrinket)and(g:BuffUp(B.AvengingWrathBuff)and B.AvengingWrath:CooldownRemains()>40 or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)==10 or T<30 or(g:BuffDown(B.CrusadeBuff)and B.Crusade:CooldownRemains()>20 or g:BuffDown(B.AvengingWrathBuff)and B.AvengingWrath:CooldownRemains()>20))then if a8 then if l.Cast(a8,nil,nil)then if a8:ID()==GetInventoryItemID("player",13)and A.Commons.Enabled.TopTrinket then N=13;return"Generic use_items for "..a8:Name()elseif a8:ID()==GetInventoryItemID("player",14)and A.Commons.Enabled.BottomTrinket then N=14;return"Generic use_items for "..a8:Name()end end end end;if C.Fyralath:IsEquippedAndReady()and(B.MarkofFyralathDebuff:AuraActiveCount()>0 and g:BuffDown(B.AvengingWrathBuff)and g:BuffDown(B.CrusadeBuff))then if o(C.Fyralath,nil,nil,not h:IsInRange(25))then N=16;return"fyralath_the_dreamrender cooldowns 11"end end;if B.ShieldofVengeance:IsCastable()and(T>15 and(not B.ExecutionSentence:IsAvailable()or h:DebuffDown(B.ExecutionSentence)))then if o(B.ShieldofVengeance,nil)then N=184662;return"shield_of_vengeance cooldowns 10"end end;if B.ExecutionSentence:IsCastable()and((g:BuffDown(B.CrusadeBuff)and B.Crusade:CooldownRemains()>15 or g:BuffStack(B.CrusadeBuff)==10 or B.AvengingWrath:CooldownRemains()<0.75 or B.AvengingWrath:CooldownRemains()>15)and(V>=4 and d.CombatTime()<5 or V>=3 and d.CombatTime()>5 or V>=2 and B.DivineAuxiliary:IsAvailable())and(h:TimeToDie()>8 and not B.ExecutionersWill:IsAvailable()or h:TimeToDie()>12))then if o(B.ExecutionSentence,nil,nil,not h:IsSpellInRange(B.ExecutionSentence))then N=343527;return"execution_sentence cooldowns 14"end end;if B.AvengingWrath:IsCastable()and(V>=4 and d.CombatTime()<5 or V>=3 and d.CombatTime()>5 or V>=2 and B.DivineAuxiliary:IsAvailable()and(B.ExecutionSentence:CooldownUp()or B.FinalReckoning:CooldownUp()))then if o(B.AvengingWrath,nil)then N=31884;return"avenging_wrath cooldowns 12"end end;if B.Crusade:IsCastable()and(V>=4 and d.CombatTime()<5 or V>=3 and d.CombatTime()>=5)then if o(B.Crusade,nil)then N=231895;return"crusade cooldowns 14"end end;if B.FinalReckoning:IsCastable()and((V>=4 and d.CombatTime()<8 or V>=3 and d.CombatTime()>=8 or V>=2 and B.DivineAuxiliary:IsAvailable())and(B.AvengingWrath:CooldownRemains()>10 or B.Crusade:CooldownDown()and(g:BuffDown(B.CrusadeBuff)or g:BuffStack(B.CrusadeBuff)>=10))and(U>0 or V==5 or V>=2 and B.DivineAuxiliary:IsAvailable()))then if o(B.FinalReckoning,nil,nil,not h:IsSpellInRange(B.FinalReckoning))then N=343721;return"final_reckoning cooldowns 18"end end end;local function a9()X=(R>=3 or R>=2 and not B.DivineArbiter:IsAvailable()or g:BuffUp(B.EmpyreanPowerBuff))and g:BuffDown(B.EmpyreanLegacyBuff)and not(g:BuffUp(B.DivineArbiterBuff)and g:BuffStack(B.DivineArbiterBuff)>24)if B.DivineStorm:IsReady()and(X and(not B.Crusade:IsAvailable()or B.Crusade:CooldownRemains()>W*3 or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)<10))then if o(B.DivineStorm,nil,nil,not h:IsInRange(8))then N=53385;return"divine_storm finishers 2"end end;if B.JusticarsVengeance:IsReady()and(not B.Crusade:IsAvailable()or B.Crusade:CooldownRemains()>W*3 or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)<10)then if o(B.JusticarsVengeance,nil,nil,not h:IsSpellInRange(B.JusticarsVengeance))then N=215661;return"justicars_vengeance finishers 4"end end;if Y:IsReady()and(not B.Crusade:IsAvailable()or B.Crusade:CooldownRemains()>W*3 or g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)<10)then if o(Y,nil,nil,not h:IsSpellInRange(Y))then N=383328;return"either verdict finishers 6"end end end;local function aa()if V>=5 or g:BuffUp(B.EchoesofWrathBuff)and g:HasTier(31,4)and B.CrusadingStrikes:IsAvailable()or(h:DebuffUp(B.JudgmentDebuff)or V==4)and g:BuffUp(B.DivineResonanceBuff)and not g:HasTier(31,2)then local ShouldReturn=a9()if ShouldReturn then return ShouldReturn end end;if B.WakeofAshes:IsCastable()and(V<=2 and(B.AvengingWrath:CooldownDown()or B.Crusade:CooldownDown())and(not B.ExecutionSentence:IsAvailable()or B.ExecutionSentence:CooldownRemains()>4 or T<8))then if o(B.WakeofAshes,nil,nil,not h:IsInRange(14))then N=255937;return"wake_of_ashes generators 2"end end;if B.BladeofJustice:IsCastable()and(h:DebuffDown(B.ExpurgationDebuff)and V<=3 and g:HasTier(31,2))then if o(B.BladeofJustice,nil,nil,not h:IsSpellInRange(B.BladeofJustice))then N=184575;return"blade_of_justice generators 4"end end;if B.DivineToll:IsCastable()and(V<=2 and(B.AvengingWrath:CooldownRemains()>15 or B.Crusade:CooldownRemains()>15 or T<8))then if o(B.DivineToll,nil,nil,not h:IsInRange(30))then N=375576;return"divine_toll generators 4"end end;if B.Judgment:IsReady()and(h:DebuffUp(B.ExpurgationDebuff)and g:BuffDown(B.EchoesofWrathBuff)and g:HasTier(31,2))then if o(B.Judgment,nil,nil,not h:IsSpellInRange(B.Judgment))then N=275773;return"judgment generators 8"end end;if V>=3 and g:BuffUp(B.CrusadeBuff)and g:BuffStack(B.CrusadeBuff)<10 then local ShouldReturn=a9()if ShouldReturn then return ShouldReturn end end;if B.TemplarSlash:IsReady()and(B.TemplarStrike:TimeSinceLastCast()+W<4 and R>=2)then if o(B.TemplarSlash,nil,nil,not h:IsSpellInRange(B.TemplarSlash))then N=406647;return"templar_slash generators 6"end end;if B.BladeofJustice:IsCastable()and((V<=3 or not B.HolyBlade:IsAvailable())and(R>=2 and not B.CrusadingStrikes:IsAvailable()or R>=4))then if o(B.BladeofJustice,nil,nil,not h:IsSpellInRange(B.BladeofJustice))then N=184575;return"blade_of_justice generators 8"end end;if B.HammerofWrath:IsReady()and((R<2 or not B.BlessedChampion:IsAvailable()or g:HasTier(30,4))and(V<=3 or h:HealthPercentage()>20 or not B.VanguardsMomentum:IsAvailable()))then if o(B.HammerofWrath,nil,nil,not h:IsSpellInRange(B.HammerofWrath))then N=24275;return"hammer_of_wrath generators 14"end end;if B.TemplarSlash:IsReady()and B.TemplarStrike:TimeSinceLastCast()+W<4 then if o(B.TemplarSlash,nil,nil,not h:IsSpellInRange(B.TemplarSlash))then N=406647;return"templar_slash generators 16"end end;if B.Judgment:IsReady()and(h:DebuffDown(B.JudgmentDebuff)and(V<=3 or not B.BoundlessJudgment:IsAvailable()))then if o(B.Judgment,nil,nil,not h:IsSpellInRange(B.Judgment))then N=275773;return"judgment generators 17"end end;if B.BladeofJustice:IsCastable()and(V<=3 or not B.HolyBlade:IsAvailable())then if o(B.BladeofJustice,nil,nil,not h:IsSpellInRange(B.BladeofJustice))then N=184575;return"blade_of_justice generators 18"end end;if h:HealthPercentage()<=20 or g:BuffUp(B.AvengingWrathBuff)or g:BuffUp(B.CrusadeBuff)or g:BuffUp(B.EmpyreanPowerBuff)then local ShouldReturn=a9()if ShouldReturn then return ShouldReturn end end;if B.Consecration:IsCastable()and(h:DebuffDown(B.ConsecrationDebuff)and R>=2)then if o(B.Consecration,nil,nil,not h:IsInRange(8))then N=317920;return"consecration generators 22"end end;if B.DivineHammer:IsCastable()and R>=2 then if o(B.DivineHammer,nil,nil,not h:IsInRange(8))then N=198034;return"divine_hammer generators 24"end end;if B.CrusaderStrike:IsCastable()and(B.CrusaderStrike:ChargesFractional()>=1.75 and(V<=2 or V<=3 and B.BladeofJustice:CooldownRemains()>W*2 or V==4 and B.BladeofJustice:CooldownRemains()>W*2 and B.Judgment:CooldownRemains()>W*2))then if o(B.CrusaderStrike,nil,nil,not h:IsSpellInRange(B.CrusaderStrike))then N=35395;return"crusader_strike generators 26"end end;local ShouldReturn=a9()if ShouldReturn then return ShouldReturn end;if B.TemplarSlash:IsReady()then if o(B.TemplarSlash,nil,nil,not h:IsSpellInRange(B.TemplarSlash))then N=406647;return"templar_slash generators 28"end end;if B.TemplarStrike:IsReady()then if o(B.TemplarStrike,nil,nil,not h:IsSpellInRange(B.TemplarStrike))then N=407480;return"templar_strike generators 30"end end;if B.Judgment:IsReady()and(V<=3 or not B.BoundlessJudgment:IsAvailable())then if o(B.Judgment,nil,nil,not h:IsSpellInRange(B.Judgment))then N=275773;return"judgment generators 32"end end;if B.HammerofWrath:IsReady()and(V<=3 or h:HealthPercentage()>20 or not B.VanguardsMomentum:IsAvailable())then if o(B.HammerofWrath,nil,nil,not h:IsSpellInRange(B.HammerofWrath))then N=24275;return"hammer_of_wrath generators 34"end end;if B.CrusaderStrike:IsCastable()then if o(B.CrusaderStrike,nil,nil,not h:IsSpellInRange(B.CrusaderStrike))then N=407480;return"crusader_strike generators 26"end end;if B.ArcaneTorrent:IsCastable()then if o(B.ArcaneTorrent,nil,nil,not h:IsInRange(8))then N=50613;return"arcane_torrent generators 28"end end;if B.Consecration:IsCastable()then if o(B.Consecration,nil,nil,not h:IsInRange(8))then N=317920;return"consecration generators 30"end end;if B.DivineHammer:IsCastable()then if o(B.DivineHammer,nil,nil,not h:IsInRange(8))then N=198034;return"divine_hammer generators 32"end end end;local function ab()E=HeroRotationCharDB.Toggles[175]F=HeroRotationCharDB.Toggles[176]G=HeroRotationCharDB.Toggles[177]H=HeroRotationCharDB.Toggles[178]I=HeroRotationCharDB.Toggles[179]J=HeroRotationCharDB.Toggles[180]K=HeroRotationCharDB.Toggles[181]L=HeroRotationCharDB.Toggles[182]end;local function ac()if ShouldReturn then return ShouldReturn end;if O>0 then O=0 end;if N>0 then N=0 end;Q=g:GetEnemiesInRange(8)if m()then R=#Q else R=1 end;U=a1()ShouldReturn=ab()if l.QueuedCast()then N=l.QueuedCast()return"Custom Queue "..j(N):ID()end;if E and B.BlessingOfFreedom:IsUsableP()and B.BlessingOfFreedom:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.BlessingOfFreedom,nil,nil,nil)then N=1044;return"queue Freedom"end elseif(not B.BlessingOfFreedom:IsUsableP()or B.BlessingOfFreedom:CooldownRemains(BypassRecovery)>0)and E then HeroRotationCharDB.Toggles[175]=not HeroRotationCharDB.Toggles[175]l.Print("Freedom Queue is now "..(HeroRotationCharDB.Toggles[175]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if F and B.HammerofJustice:IsUsableP()and B.HammerofJustice:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.HammerofJustice,nil,nil,nil)then N=853;return"queue HammerofJustice"end elseif(not B.HammerofJustice:IsUsableP()or B.HammerofJustice:CooldownRemains(BypassRecovery)>0)and F then HeroRotationCharDB.Toggles[176]=not HeroRotationCharDB.Toggles[176]l.Print("HammerofJustice Queue is now "..(HeroRotationCharDB.Toggles[176]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if G and B.BlindingLight:IsUsableP()and B.BlindingLight:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.BlindingLight,nil,nil,nil)then N=115750;return"queue BlindingLight"end elseif(not B.BlindingLight:IsUsableP()or B.BlindingLight:CooldownRemains(BypassRecovery)>0)and G then HeroRotationCharDB.Toggles[177]=not HeroRotationCharDB.Toggles[177]l.Print("BlindingLight Queue is now "..(HeroRotationCharDB.Toggles[177]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if H and B.BlessingOfProtection:IsUsableP()and B.BlessingOfProtection:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.BlessingOfProtection,nil,nil,nil)then N=1022;return"queue BlessingOfProtection"end elseif(not B.BlessingOfProtection:IsUsableP()or B.BlessingOfProtection:CooldownRemains(BypassRecovery)>0)and H then HeroRotationCharDB.Toggles[178]=not HeroRotationCharDB.Toggles[178]l.Print("BlessingOfProtection Queue is now "..(HeroRotationCharDB.Toggles[178]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if I and B.BlessingofSacrifice:IsUsableP()and B.BlessingofSacrifice:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.BlessingofSacrifice,nil,nil,nil)then N=6940;return"queue BlessingofSacrifice"end elseif(not B.BlessingofSacrifice:IsUsableP()or B.BlessingofSacrifice:CooldownRemains(BypassRecovery)>0)and I then HeroRotationCharDB.Toggles[179]=not HeroRotationCharDB.Toggles[179]l.Print("BlessingofSacrifice Queue is now "..(HeroRotationCharDB.Toggles[179]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if J and B.Repentance:IsUsableP()and B.Repentance:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.Repentance,nil,nil,nil)then N=20066;return"queue Repentance"end elseif(not B.Repentance:IsUsableP()or B.Repentance:CooldownRemains(BypassRecovery)>0)and J then HeroRotationCharDB.Toggles[180]=not HeroRotationCharDB.Toggles[180]l.Print("Repentance Queue is now "..(HeroRotationCharDB.Toggles[180]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if K and B.TurnEvil:IsUsableP()and B.TurnEvil:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.TurnEvil,nil,nil,nil)then N=10326;return"queue TurnEvil"end elseif(not B.TurnEvil:IsUsableP()or B.TurnEvil:CooldownRemains(BypassRecovery)>0)and K then HeroRotationCharDB.Toggles[181]=not HeroRotationCharDB.Toggles[181]l.Print("TurnEvil Queue is now "..(HeroRotationCharDB.Toggles[181]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if L and B.Intercession:IsUsableP()and B.Intercession:CooldownRemains(BypassRecovery)<=0 then if l.Cast(B.Intercession,nil,nil,nil)then N=391054;return"queue Intercession"end elseif(not B.Intercession:IsUsableP()or B.Intercession:CooldownRemains(BypassRecovery)>0)and L then HeroRotationCharDB.Toggles[182]=not HeroRotationCharDB.Toggles[182]l.Print("Intercession Queue is now "..(HeroRotationCharDB.Toggles[182]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B.TurnEvil:IsReady()and t.HandleIncorporeal(B.TurnEvil,r,20,true)then if o(B.TurnEvil)then O=110326;return"Cast Turn Evil to Incorporeal"end end;if B.Repentance:IsReady()and t.HandleIncorporeal(B.Repentance,r,30,true)then if o(B.Repentance)then O=120066;return"Cast Repentance to Incorporeal"end end;if t.HandleAfflicted(B.CleanseToxins,r,20,false)then if o(B.CleanseToxins)then O=1213644;return"Cast CleanseToxins to Afflicted"end end;if t.TargetIsValid()or g:AffectingCombat()then S=d.BossFightRemains()T=S;if T==11111 then T=d.FightRemains(Q,false)end;W=g:GCD()V=g:HolyPower()end;if g:IsMounted()==true then if B.CrusaderAura:IsCastable()and not g:BuffUp(B.CrusaderAura)then if o(B.CrusaderAura)then N=32223;return"CrusaderAura for Mountspeed"end end else if B.RetributionAura:IsCastable()and not g:BuffUp(B.RetributionAura)then if o(B.RetributionAura)then N=183435;return"Retribution Aura for Fighting"end end end;if t.TargetIsValid()and(not g:AffectingCombat()or M)then if not g:AffectingCombat()then local ShouldReturn=a5()if ShouldReturn then return ShouldReturn end end;if n()then local ShouldReturn=a6()if ShouldReturn then return ShouldReturn end end;local ShouldReturn=aa()if ShouldReturn then return ShouldReturn end;if o(B.Pool)then return"Wait/Pool Resources"end end end;function ReturnSpell()if N==0 then return 0 else return N end end;function ReturnSpellMO()if O==0 then return 0 else return O end end;local function ad()B.MarkofFyralathDebuff:RegisterAuraTracking()l.Print("Retribution Paladin rotation has been updated for patch 10.2.0.")end;l.SetAPL(70,ac,ad)