local a,b=...local c=HeroDBC.DBC;local d=HeroLib;local e=HeroCache;local f=d.Unit;local g=f.Player;local h=f.Target;local i=d.Spell;local j=d.MultiSpell;local k=d.Item;local l=d.Utils.BoolToInt;local m=HeroRotation;local n=m.AoEON;local o=m.CDsON;local p=HeroRotationCharDB.Toggles[4]local q=HeroRotationCharDB.Toggles[5]local r=HeroRotationCharDB.Toggles[12]local s=not HeroRotationCharDB.Toggles[15]local t=HeroRotationCharDB.Toggles[20]local u=HeroRotationCharDB.Toggles[21]local v=HeroRotationCharDB.Toggles[22]local w=HeroRotationCharDB.Toggles[23]local x=HeroRotationCharDB.Toggles[24]local y=HeroRotationCharDB.Toggles[25]local z=HeroRotationCharDB.Toggles[26]local A=HeroRotationCharDB.Toggles[27]local B=HeroRotationCharDB.Toggles[28]local C=HeroRotationCharDB.Toggles[29]local D=HeroRotationCharDB.Toggles[30]local E=HeroRotationCharDB.Toggles[54]local F=HeroRotationCharDB.Toggles[171]local G=HeroRotationCharDB.Toggles[172]local H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337,382555}local I=nil;local J=nil;local K=0;local L=0;local pairs=pairs;local M=table.insert;local N=math.min;local O=math.max;local P=math.abs;local Q=m.Commons.Everyone;local R=m.Commons.Rogue;local S=i.Rogue.Subtlety;local T=k.Rogue.Subtlety;local U={T.ManicGrieftorch:ID(),T.BeaconToTheBeyond:ID()}local V={General=m.GUISettings.General,Commons=m.GUISettings.APL.Rogue.Commons,Subtlety=m.GUISettings.APL.Rogue.Subtlety}S.Eviscerate:RegisterDamageFormula(function()return g:AttackPowerDamageMod()*EffectiveComboPoints*0.176*1.21*(S.Nightstalker:IsAvailable()and g:StealthUp(true,false)and 1.08 or 1)*(S.DeeperStratagem:IsAvailable()and 1.05 or 1)*(S.DarkShadow:IsAvailable()and g:BuffUp(S.ShadowDanceBuff)and 1.3 or 1)*(g:BuffUp(S.SymbolsofDeath)and 1.1 or 1)*(g:BuffUp(S.FinalityEviscerateBuff)and 1.3 or 1)*(1+g:MasteryPct()/100)*(1+g:VersatilityDmgPct()/100)*(h:DebuffUp(S.FindWeaknessDebuff)and 1.5 or 1)end)S.Rupture:RegisterPMultiplier(function()return g:BuffUp(S.FinalityRuptureBuff)and 1.3 or 1 end)local V={General=m.GUISettings.General,Commons=m.GUISettings.APL.Rogue.Commons,Commons2=m.GUISettings.APL.Rogue.Commons2,Subtlety=m.GUISettings.APL.Rogue.Subtlety}local function W()if V.Subtlety.BurnShadowDance=="On Bosses not in Dungeons"and g:IsInDungeonArea()then return false elseif V.Subtlety.BurnShadowDance~="Always"and not h:IsInBossList()then return false else return true end end;local X=g:GetEquipment()local Y=X[13]and k(X[13])or k(0)local Z=X[14]and k(X[14])or k(0)local _=GetInventoryItemID("player",13)local a0=GetInventoryItemID("player",14)local U={}d:RegisterForEvent(function()X=g:GetEquipment()Y=X[13]and k(X[13])or k(0)Z=X[14]and k(X[14])or k(0)end,"PLAYER_EQUIPMENT_CHANGED")local a1,a2,a3,a4;local a5,a6,a7,a8;local a9;local aa=R.ReturnSpell()local ab=R.ReturnSpellMO()local ac,ad,ae;local af,ag;local ah,ai;local aj=11111;local ak=11111;local al,am,an;local ao;local ap;local aq;local ar;local as;local at;local au;local av;local aw;local ax=false;local function ay(az,aA,aB,aC)local aD,aE=nil,aB;local aF=h:GUID()for aG,aH in pairs(aC)do if aH:GUID()~=aF and Q.UnitIsCycleValid(aH,aE,-aH:DebuffRemains(az))and aA(aH)then aD,aE=aH,aH:TimeToDie()end end;if aD then m.CastLeftNameplate(aD,az)if aD:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then if az==S.Rupture then ab=11943 elseif az==S.SerratedBoneSpike then ab=1328547 end elseif V.Subtlety.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not r then ab=9999 end elseif false then aD,aE=nil,aB;for aG,aH in pairs(a2)do if aH:GUID()~=aF and Q.UnitIsCycleValid(aH,aE,-aH:DebuffRemains(az))and aA(aH)then aD,aE=aH,aH:TimeToDie()end end;if aD then m.CastLeftNameplate(aD,az)if aD:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then if az==S.Rupture then ab=11943 elseif az==S.SerratedBoneSpike then ab=1328547 end elseif V.Subtlety.TargetSwap=="AutoSwap"and aD:GUID()~=h:GUID()and not r then ab=9999 end end end end;local function aI()if a3<2 then return false elseif V.Commons.UsePriorityRotation=="Always"then return true elseif V.Commons.UsePriorityRotation=="On Bosses"and h:IsInBossList()then return true elseif V.Commons.UsePriorityRotation=="Auto"then if g:InstanceDifficulty()==16 and h:NPCID()==138967 then return true elseif h:NPCID()==166969 or h:NPCID()==166971 or h:NPCID()==166970 then return true elseif h:NPCID()==183463 or h:NPCID()==183671 then return true end end;return false end;local aJ=g:CovenantID()d:RegisterForEvent(function()aJ=g:CovenantID()end,"COVENANT_CHOSEN")d:RegisterForEvent(function()aj=11111;ak=11111 end,"PLAYER_REGEN_ENABLED")local function aK(aL)if aL then return 1 else return 0 end end;local function aM()return 20+S.Vigor:TalentRank()*25+aK(S.ThistleTea:IsAvailable())*20+aK(S.Shadowcraft:IsAvailable())*20 end;local function aN()return S.ShadowDance:ChargesFractional()>=0.75+l(S.ShadowDanceTalent:IsAvailable())end;local function aO()return an>=3 end;local function aw()return g:BuffUp(S.SliceandDice)or a3>=R.CPMaxSpend()end;local function aP()return S.Premeditation:IsAvailable()and a3<5 end;local function aQ(aR)return g:BuffUp(S.ThistleTea)and a3==1 or aR and(a3==1 or h:DebuffUp(S.Rupture)and a3>=2)end;local function aS()return(not g:BuffUp(S.TheRotten)or not g:HasTier(30,2))and(not S.ColdBlood:IsAvailable()or S.ColdBlood:CooldownRemains()<4 or S.ColdBlood:CooldownRemains()>10)end;local function aT(i)return g:BuffUp(S.ShadowDanceBuff)and i:TimeSinceLastCast()<S.ShadowDance:TimeSinceLastCast()end;local function aU()return(aT(S.Shadowstrike)or aT(S.ShurikenStorm))and(aT(S.Eviscerate)or aT(S.BlackPowder)or aT(S.Rupture))or not S.DanseMacabre:IsAvailable()end;local function aV()return not T.WitherbarksBranch:IsEquipped()and not T.AshesoftheEmbersoul:IsEquipped()or not T.WitherbarksBranch:IsEquipped()and T.WitherbarksBranch:CooldownRemains()<=8 or T.WitherbarksBranch:IsEquipped()and T.WitherbarksBranch:CooldownRemains()<=8 or T.BandolierOfTwistedBlades:IsEquipped()or S.InvigoratingShadowdust:IsAvailable()end;local function aW(aX)if(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aX:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then ab=1185438;return true elseif(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and V.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif(aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains())and aX:GUID()==h:GUID()then aa=185438;return true elseif aX:DebuffRemains(S.FindWeaknessDebuff)<1 or S.SymbolsofDeath:CooldownRemains()<18 and aX:DebuffRemains(S.FindWeaknessDebuff)<S.SymbolsofDeath:CooldownRemains()then return true end end;local function aY(aX)if aX:IsInRange(8)and aX:TimeToDie()>10 and aX:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then ab=1323654;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 and V.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 and aX:GUID()==h:GUID()then aa=323654;return true elseif aX:IsInRange(8)and aX:TimeToDie()>10 then return true end end;local function aZ(aX)if(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aX:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then ab=1137619;return true elseif(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and V.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif(aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend())and aX:GUID()==h:GUID()then aa=137619;return true elseif aX:FilteredTimeToDie("<",an)or not g:StealthUp(true,true)and g:ComboPointsDeficit()>=R.CPMaxSpend()then return true end end;local function a_(aX)if aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and aX:GUID()==f("mouseover"):GUID()and V.Subtlety.TargetSwap=="Mouseover"then ab=11943;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and V.Subtlety.TargetSwap=="AutoSwap"and aX:GUID()~=h:GUID()and not r then ab=9999;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)and aX:GUID()==h:GUID()then aa=1943;return true elseif aX:FilteredTimeToDie(">=",2*am)and aX:DebuffRefreshable(S.Rupture)then return true end end;local function b0()local b1=not EnergyThreshold or g:EnergyPredicted()>=EnergyThreshold;if m.AoEON()and S.ShurikenStorm:IsCastable()and a3>=2+l(S.Gloomblade:IsAvailable()and g:BuffRemains(S.LingeringShadowBuff)>=6 or g:BuffUp(S.PerforatedVeinsBuff))then if m.Cast(S.ShurikenStorm)then aa=197835;return"Cast Shuriken Storm"end end;if a7 then if S.Gloomblade:IsCastable()then if b1 and m.Cast(S.Gloomblade)then aa=200758;return"Cast Gloomblade"end elseif S.Backstab:IsCastable()then if b1 and m.Cast(S.Backstab)then aa=53;return"Cast Backstab"end end end end;local function b2()if g:BuffUp(S.ShurikenTornado)then if S.SymbolsofDeath:IsCastable()and S.ShadowDance:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not g:BuffUp(S.ShadowDanceBuff)and not G and not F then if m.Cast(S.SymbolsofDeath)then aa=800;return"Dance + Symbols (during Tornado)"end elseif S.SymbolsofDeath:IsCastable()and not g:BuffUp(S.SymbolsofDeath)and not G then if m.Cast(S.SymbolsofDeath)then aa=212283;return"Cast Symbols of Death (during Tornado)"end elseif S.ShadowDance:IsCastable()and not g:BuffUp(S.ShadowDanceBuff)and not F then if m.Cast(S.ShadowDance)then aa=185313;return"Cast Shadow Dance (during Tornado)"end end end;if S.Vanish:IsCastable()and VanishReady and not u and V.Commons.VanishOffensive and am<=2 and g:BuffStack(S.DanseMacabreBuff)>3 and(S.SecretTechnique:CooldownRemains()>=30 or not S.SecretTechnique:IsAvailable())then if m.Cast(S.Vanish,nil,nil)then aa=1856;return"Vanish Stealth CD"end end;if m.CDsON()and S.ColdBlood:IsReady()and not S.SecretTechnique:IsAvailable()and am>=5 then if m.Cast(S.ColdBlood)then aa=382245;return"Cast Cold Blood"end end;if m.CDsON()and S.Sepsis:IsAvailable()and S.Sepsis:IsReady()then if aw()and h:FilteredTimeToDie(">=",16)and(g:BuffUp(S.PerforatedVeins)or not S.PerforatedVeins:IsAvailable())then if m.Cast(S.Sepsis,nil,nil)then aa=328305;return"Cast Sepsis"end end end;if m.CDsON()and S.Flagellation:IsAvailable()and S.Flagellation:IsReady()then if aw()and EffectiveComboPoints>=5 and h:TimeToDie()>10 and(aV()and S.ShadowBlades:CooldownRemains()<=3 or d.BossFilteredFightRemains("<=",28)or S.ShadowBlades:CooldownRemains()>=14 and S.InvigoratingShadowdust:IsAvailable()and S.ShadowDance:IsAvailable())and(not S.InvigoratingShadowdust:IsAvailable()or S.Sepsis:IsAvailable()or not S.ShadowDance:IsAvailable()or S.InvigoratingShadowdust:TalentRank()==2 and a3>=2 or S.SymbolsofDeath:CooldownRemains()<=3 or g:BuffRemains(S.SymbolsofDeath)>3)then if m.Cast(S.Flagellation,nil)then aa=323654;return"Cast Flagellation"end end end;if m.CDsON()and S.SymbolsofDeath:IsReady()then if aw()and(not g:BuffUp(S.TheRotten)or not g:HasTier(30,2))and g:BuffRemains(S.SymbolsofDeath)<=3 and(not S.Flagellation:IsAvailable()or S.Flagellation:CooldownRemains()>10 or g:BuffRemains(S.ShadowDance)>=2 and S.InvigoratingShadowdust:IsAvailable()or S.Flagellation:IsReady()and EffectiveComboPoints>=5 and not S.InvigoratingShadowdust:IsAvailable())then if m.Cast(S.SymbolsofDeath,nil)then aa=212283;return"Cast Symbols of Death"end end end;if m.CDsON()and S.ShadowBlades:IsReady()then if aw()and(EffectiveComboPoints<=1 or g:HasTier(31,4))and(g:BuffUp(S.Flagellation)or g:BuffUp(S.FlagellationPersistBuff)or not S.Flagellation:IsAvailable())then if m.Cast(S.ShadowBlades,nil)then aa=121471;return"Cast Shadow Blades"end end end;if m.CDsON()and S.EchoingReprimand:IsCastable()and S.EchoingReprimand:IsAvailable()then if aw()and an>=3 then if m.Cast(S.EchoingReprimand,nil,nil)then aa=323547;return"Cast Echoing Reprimand"end end end;if m.CDsON()and S.ShurikenTornado:IsAvailable()and S.ShurikenTornado:IsReady()then if aw()and g:BuffUp(S.SymbolsofDeath)and EffectiveComboPoints<=2 and not g:BuffUp(S.Premeditation)and(not S.Flagellation:IsAvailable()or S.Flagellation:CooldownRemains()>20)and a3>=3 then if m.Cast(S.ShurikenTornado)then aa=277925;return"Cast Shuriken Tornado1"end end end;if m.CDsON()and S.ShurikenTornado:IsAvailable()and S.ShurikenTornado:IsReady()then if aw()and not g:BuffUp(S.ShadowDance)and not g:BuffUp(S.Flagellation)and not g:BuffUp(S.FlagellationPersistBuff)and not g:BuffUp(S.ShadowBlades)and a3<=2 then if m.Cast(S.ShurikenTornado)then aa=277925;return"Cast Shuriken Tornado2"end end end;if m.CDsON()and S.ShadowDance:IsAvailable()and W()and S.ShadowDance:IsReady()then if not g:BuffUp(S.ShadowDance)and d.BossFilteredFightRemains("<=",8+3*aK(S.Subterfuge:IsAvailable()))then if m.Cast(S.ShadowDance)then aa=185313;return"Cast Shadow Dance"end end end;if m.CDsON()and S.GoremawsBite:IsAvailable()and S.GoremawsBite:IsReady()then if aw()and an>=3 and(not S.ShadowDance:IsReady()or S.ShadowDance:IsAvailable()and g:BuffUp(S.ShadowDance)and not S.InvigoratingShadowdust:IsAvailable()or a3<4 and not S.InvigoratingShadowdust:IsAvailable()or S.TheRotten:IsAvailable())then if m.Cast(S.GoremawsBite)then aa=426591;return"Cast Goremaw's Bite"end end end;if S.ThistleTea:IsReady()then if(S.SymbolsofDeath:CooldownRemains()>=3 or g:BuffUp(S.SymbolsofDeath))and not g:BuffUp(S.ThistleTea)and(g:EnergyDeficitPredicted()>=100 and(an>=2 or a3>=3)or S.ThistleTea:ChargesFractional()>=2.75-0.15*S.InvigoratingShadowdust:TalentRank()and S.Vanish:IsReady()and g:BuffUp(S.ShadowDance)and h:DebuffUp(S.Rupture)and a3<3)or g:BuffRemains(S.ShadowDance)>=4 and not g:BuffUp(S.ThistleTea)and a3>=3 or not g:BuffUp(S.ThistleTea)and d.BossFilteredFightRemains("<=",6*S.ThistleTea:Charges())then if m.Cast(S.ThistleTea)then aa=381623;return"Cast ThistleTea"end end end;if V.Commons.Enabled.Potions and o()and s and((g:BloodlustUp()or ak<30 or g:BuffUp(S.SymbolsofDeath)and(g:BuffUp(S.ShadowBlades)or S.ShadowBlades:CooldownRemains()<=10))and not m.GUISettings.General.HoldPotforBL or m.GUISettings.General.HoldPotforBL and g:BloodlustUp())then local b3=Q.PotionSelected()if b3 and b3:IsReady()then if m.Cast(b3,nil,nil)then aa=37;return"potion cooldowns 2"end end end;local b4=g:BuffUp(S.ShadowBlades)or not S.ShadowBlades:IsAvailable()and g:BuffUp(S.SymbolsofDeath)or d.BossFilteredFightRemains("<",20)if V.Commons.Enabled.Racials then if S.BloodFury:IsCastable()and b4 then if m.Cast(S.BloodFury,nil)then aa=20572;return"Cast Blood Fury"end end;if S.Berserking:IsCastable()and b4 then if m.Cast(S.Berserking,nil)then aa=26297;return"Cast Berserking"end end;if S.Fireblood:IsCastable()and b4 then if m.Cast(S.Fireblood,nil)then aa=265221;return"Cast Fireblood"end end;if S.AncestralCall:IsCastable()and b4 then if m.Cast(S.AncestralCall,nil)then aa=274738;return"Cast Ancestral Call"end end end;if not g:StealthUp(true,true)or d.BossFilteredFightRemains("<",10)then local b5=g:GetUseableTrinkets(U)if b5 and o()then if m.Cast(b5,nil,nil)then if b5:ID()==GetInventoryItemID("player",13)and V.Commons.Enabled.TopTrinket then aa=24;return"Generic use_items for "..b5:Name()elseif b5:ID()==GetInventoryItemID("player",14)and V.Commons.Enabled.BottomTrinket then aa=25;return"Generic use_items for "..b5:Name()end end end end;if S.ThistleTea:IsReady()then if(S.SymbolsofDeath:CooldownRemains()>=3 or g:BuffUp(S.SymbolsofDeath))and not g:BuffUp(S.ThistleTea)and(g:EnergyDeficitPredicted()>=100 and(g:ComboPointsDeficit()>=2 or a3>=3)or S.ThistleTea:ChargesFractional()>=2.75 and g:BuffUp(S.ShadowDanceBuff))or g:BuffRemains(S.ShadowDanceBuff)>=4 and not g:BuffUp(S.ThistleTea)and a3>=3 or not g:BuffUp(S.ThistleTea)and d.BossFilteredFightRemains("<=",6*S.ThistleTea:Charges())then if m.Cast(S.ThistleTea)then aa=381623;return"Cast Thistle Tea"end end end;if V.Commons.Enabled.Potions and o()and s and((g:BloodlustUp()or ak<30 or g:BuffUp(S.SymbolsofDeath)and(g:BuffUp(S.ShadowBlades)or S.ShadowBlades:CooldownRemains()<=10))and not m.GUISettings.General.HoldPotforBL or m.GUISettings.General.HoldPotforBL and g:BloodlustUp())then local b3=Q.PotionSelected()if b3 and b3:IsReady()then if m.Cast(b3,nil,nil)then aa=37;return"potion cooldowns 2"end end end;if g:BuffUp(S.SymbolsofDeath)and o()then if S.BloodFury:IsReady()and V.Commons.Enabled.Racials then if m.Cast(S.BloodFury,nil)then aa=20572;return"Cast Blood Fury"end end;if S.Berserking:IsReady()and V.Commons.Enabled.Racials then if m.Cast(S.Berserking,nil)then aa=26297;return"Cast Berserking"end end;if S.Fireblood:IsReady()and V.Commons.Enabled.Racials then if m.Cast(S.Fireblood,nil)then aa=265221;return"Cast Fireblood"end end;if S.AncestralCall:IsReady()and V.Commons.Enabled.Racials then if m.Cast(S.AncestralCall,nil)then aa=274738;return"Cast Ancestral Call"end end end end;local function b6()local aR=g:BuffUp(S.ShadowDanceBuff)local b7=g:BuffRemains(S.ShadowDanceBuff)local b8=g:BuffRemains(S.SymbolsofDeath)local b9=am;local ba=S.ColdBlood:CooldownRemains()local bb=S.SymbolsofDeath:CooldownRemains()local bc=g:BuffUp(S.PremeditationBuff)or StealthSpell and S.Premeditation:IsAvailable()if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aR=true;b7=8+S.ImprovedShadowDance:TalentRank()if S.TheFirstDance:IsAvailable()then b9=N(g:ComboPointsMax(),am+4)end;if g:HasTier(30,2)then b8=O(b8,6)end end;if StealthSpell and StealthSpell:ID()==S.Vanish:ID()then ba=N(0,S.ColdBlood:CooldownRemains()-15*S.InvigoratingShadowdust:TalentRank())bb=N(0,S.SymbolsofDeath:CooldownRemains()-15*S.InvigoratingShadowdust:TalentRank())end;if S.Rupture:IsCastable()and S.Rupture:IsReady()then if h:DebuffDown(S.Rupture)and h:TimeToDie()>6 then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture "end end end;if not g:StealthUp(true,true)and not aP()and a3<6 and not aR and d.BossFilteredFightRemains(">",g:BuffRemains(S.SliceandDice))and g:BuffRemains(S.SliceandDice)<(1+g:ComboPoints())*1.8 then if S.SliceandDice:IsReady()and m.Cast(S.SliceandDice)then aa=5171;return"Cast Slice and Dice"end end;if(not aQ(aR)or ao)and h:TimeToDie()>6 and h:DebuffRefreshable(S.Rupture,ah)then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture "end end;if g:BuffUp(S.FinalityRuptureBuff)and aR and a3<=4 and not aT(S.Rupture)then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture "end end;if S.ColdBlood:IsReady()and aU(aR,bc)and S.SecretTechnique:IsReady()then if m.Cast(S.ColdBlood)then aa=382245;return"Cast Cold Blood"end end;if S.SecretTechnique:IsReady()then if aU(aR,bc)and(not S.ColdBlood:IsAvailable()or V.Commons.OffGCDasOffGCD.ColdBlood and S.ColdBlood:IsReady()or g:BuffUp(S.ColdBlood)or ba>b7-2 or not S.ImprovedShadowDance:IsAvailable())then if m.Cast(S.SecretTechnique)then aa=280719;return"Cast Secret Technique"end end end;if not aQ(aR)and S.Rupture:IsCastable()then if m.AoEON()and not ao and a3>=2 then local function bd(aX)return Q.CanDoTUnit(aX,ai)and aX:DebuffRefreshable(S.Rupture,ah)end;ay(S.Rupture,bd,2*b9,a4)end;if a7 and h:DebuffRemains(S.Rupture)<bb+10 and bb<=5 and R.CanDoTUnit(h,ai)and h:FilteredTimeToDie(">",5+bb,-h:DebuffRemains(S.Rupture))then if m.Cast(S.Rupture)then aa=1943;return"Cast Rupture"end end end;if S.BlackPowder:IsCastable()and(not ao and a3>=3)then if S.BlackPowder:IsReady()and m.Cast(S.BlackPowder)then aa=319175;return"Cast Black Powder"end end;if S.Eviscerate:IsCastable()and a7 then if S.Eviscerate:IsReady()and m.Cast(S.Eviscerate)then aa=196819;return"Cast Eviscerate"end end end;local function be()local aR=g:BuffUp(S.ShadowDanceBuff)local b7=g:BuffRemains(S.ShadowDanceBuff)local bf=g:BuffUp(S.TheRottenBuff)local bg,bh=am,an;local bc=g:BuffUp(S.PremeditationBuff)or StealthSpell and S.Premeditation:IsAvailable()local bi=g:BuffUp(R.StealthSpell())or StealthSpell and StealthSpell:ID()==R.StealthSpell():ID()local bj=g:BuffUp(R.VanishBuffSpell())or StealthSpell and StealthSpell:ID()==S.Vanish:ID()if StealthSpell and StealthSpell:ID()==S.ShadowDance:ID()then aR=true;b7=8+S.ImprovedShadowDance:TalentRank()if S.TheRotten:IsAvailable()and g:HasTier(30,2)then bf=true end;if S.TheFirstDance:IsAvailable()then bg=N(g:ComboPointsMax(),am+4)bh=g:ComboPointsMax()-bg end end;local bk=R.EffectiveComboPoints(bg)local bl=S.Shadowstrike:IsCastable()or bi or bj or aR or g:BuffUp(S.SepsisBuff)if bi or bj then bl=bl and h:IsInRange(25)else bl=bl and a7 end;if bl and bi and(a3<4 or ao)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike (Stealth)"end end;if bk>=R.CPMaxSpend()then return b6()end;if g:BuffUp(S.ShurikenTornado)and bh<=2 then return b6()end;if an<=1+aK(S.DeeperStratagem:IsAvailable()or S.SecretStratagem:IsAvailable())then return b6()end;if S.Backstab:IsCastable()and not bc and b7>=3 and g:BuffUp(S.ShadowBlades)and not aT(S.Backstab)and S.DanseMacabre:IsAvailable()and a3<=3 and not bf then if m.Cast(S.Backstab)then aa=600;return"Cast Backstab (Stealth)"end end;if S.Gloomblade:IsAvailable()then if not bc and b7>=3 and g:BuffUp(S.ShadowBlades)and not aT(S.Gloomblade)and S.DanseMacabre:IsAvailable()and a3<=4 then if m.Cast(S.Gloomblade)then aa=700;return"Cast Gloomblade (Stealth)"end end end;if not aT(S.Shadowstrike)and g:BuffUp(S.ShadowBlades)then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike (DANCE)"end end;if not bc and a3>=4 and S.ShurikenTornado:IsReady()and S.ShurikenTornado:IsAvailable()then if m.Cast(S.ShurikenTornado)then aa=277925;return"Cast Shuriken Tornado3"end end;if bl then if m.Cast(S.Shadowstrike)then aa=185438;return"Cast Shadowstrike"end end;return false end;local function bm()if m.CDsON()and S.ShadowDance:TimeSinceLastDisplay()>0.3 and S.Shadowmeld:TimeSinceLastDisplay()>0.3 and not g:IsTanking(h)then if S.Vanish:IsCastable()and(not S.DanseMacabre:IsAvailable()or a3>=3)and not aN()and an>1 and(S.Flagellation:CooldownRemains()>=60 or not S.Flagellation:IsAvailable()or d.BossFilteredFightRemains("<=",30*S.Vanish:Charges()))then if m.Cast(S.Vanish,nil,nil)then aa=1856;return"Vanish Stealth CD"end end;if S.Shadowmeld:IsCastable()and a7 and not g:IsMoving()and g:EnergyDeficitPredicted()>10 and not aN()and an>4 then if g:Energy()<40 then if m.CastPooling(S.Shadowmeld,g:EnergyTimeToX(40))then aa=1000;return"Pool for Shadowmeld"end end end end;if a7 and S.ShadowDance:IsCastable()then if(h:DebuffUp(S.Rupture)or S.InvigoratingShadowdust:IsAvailable())and aS()and(not S.TheFirstDance:IsAvailable()or an>=4 or g:BuffUp(S.ShadowBlades))and(aO()and aN()or(g:BuffUp(S.ShadowBlades)or g:BuffUp(S.SymbolsofDeath)and not S.Sepsis:IsAvailable()or g:BuffRemains(S.SymbolsofDeath)>=4 and not g:HasTier(30,2)or not g:BuffUp(S.SymbolsofDeath)and g:HasTier(30,2))and S.SecretTechnique:CooldownRemains()<10+12*aK(not S.InvigoratingShadowdust:IsAvailable()or g:HasTier(30,2)))then if m.Cast(S.ShadowDance)then aa=185313;return"Shadow Dance Stealth CD 1"end end end end;local function bn()ac=nil;ae=nil;ad=0;a5=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a6=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a7=h:IsInMeleeRange(a5)a8=h:IsInMeleeRange(a6)q=HeroRotationCharDB.Toggles[5]p=HeroRotationCharDB.Toggles[4]r=HeroRotationCharDB.Toggles[12]s=not HeroRotationCharDB.Toggles[15]t=HeroRotationCharDB.Toggles[20]u=HeroRotationCharDB.Toggles[21]v=HeroRotationCharDB.Toggles[22]w=HeroRotationCharDB.Toggles[23]x=HeroRotationCharDB.Toggles[24]y=HeroRotationCharDB.Toggles[25]z=HeroRotationCharDB.Toggles[26]A=HeroRotationCharDB.Toggles[27]B=HeroRotationCharDB.Toggles[28]C=HeroRotationCharDB.Toggles[29]D=HeroRotationCharDB.Toggles[30]E=HeroRotationCharDB.Toggles[54]F=HeroRotationCharDB.Toggles[172]G=HeroRotationCharDB.Toggles[173]SBReady=false;SDReady=false;VanishReady=false;SoDReady=false;MfDReady=true;STReady=false;if V.Subtlety.IncludedCooldowns.ShadowBlades and o()or V.Subtlety.IncludedSmallCooldowns.ShadowBlades and(o()or p)or not V.Subtlety.IncludedSmallCooldowns.ShadowBlades and not V.Subtlety.IncludedCooldowns.ShadowBlades then SBReady=true end;if V.Subtlety.IncludedCooldowns.ShadowDance and o()or V.Subtlety.IncludedSmallCooldowns.ShadowDance and(o()or p)or not V.Subtlety.IncludedSmallCooldowns.ShadowDance and not V.Subtlety.IncludedCooldowns.ShadowDance then SDReady=true end;if V.Subtlety.IncludedCooldowns.Vanish and o()or V.Subtlety.IncludedSmallCooldowns.Vanish and(o()or p)or not V.Subtlety.IncludedSmallCooldowns.Vanish and not V.Subtlety.IncludedCooldowns.Vanish then VanishReady=true end;if V.Subtlety.IncludedCooldowns.SymbolsofDeath and o()or V.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and(o()or p)or not V.Subtlety.IncludedSmallCooldowns.SymbolsofDeath and not V.Subtlety.IncludedCooldowns.SymbolsofDeath then SoDReady=true end;if V.Subtlety.IncludedCooldowns.ShurikenTornado and o()or V.Subtlety.IncludedSmallCooldowns.ShurikenTornado and(o()or p)or not V.Subtlety.IncludedSmallCooldowns.ShurikenTornado and not V.Subtlety.IncludedCooldowns.ShurikenTornado then STReady=true end;_=GetInventoryItemID("player",13)a0=GetInventoryItemID("player",14)ax=false end;local function bo()if S.Subterfuge:IsAvailable()then af=S.Stealth2;ag=S.VanishBuff2 else af=S.Stealth;ag=S.VanishBuff end;a9=bn()a5=S.AcrobaticStrikes:IsAvailable()and 8 or 5;a6=S.AcrobaticStrikes:IsAvailable()and 13 or 10;a7=h:IsInMeleeRange(a5)a8=h:IsInMeleeRange(a6)if n()then a1=g:GetEnemiesInRange(30)a2=g:GetEnemiesInMeleeRange(a6)a3=#a2;a4=g:GetEnemiesInMeleeRange(a5)else a1={}a2={}a3=1;a4={}end;am=g:ComboPoints()EffectiveComboPoints=R.EffectiveComboPoints(am)an=g:ComboPointsDeficit()ao=aI()StealthEnergyRequired=g:EnergyMax()-aM()if Q.TargetIsValid()or g:AffectingCombat()then if IsInRaid()and UnitExists("boss1")then aj=d.BossFightRemains(nil,true)ak=aj;if ak==11111 then ak=d.FightRemains(Enemies10yd,false)end end end;if EffectiveComboPoints>am and an>2 and g:AffectingCombat()then if am==2 and not g:BuffUp(S.EchoingReprimand3)or am==3 and not g:BuffUp(S.EchoingReprimand4)or am==4 and not g:BuffUp(S.EchoingReprimand5)then local bp=R.TimeToSht(4)if bp==0 then bp=R.TimeToSht(5)end;if bp<O(g:EnergyTimeToX(35),g:GCDRemains())+0.5 then EffectiveComboPoints=am end end end;if g:BuffUp(S.ShurikenTornado,nil,true)and am<R.CPMaxSpend()and not C then local bq=R.TimeToNextTornado()if bq<=g:GCDRemains()or P(g:GCDRemains()-bq)<0.25 then local br=a3+aK(g:BuffUp(S.ShadowBlades))am=N(am+br,R.CPMaxSpend())an=O(an-br,0)if EffectiveComboPoints<R.CPMaxSpend()then EffectiveComboPoints=am end end end;ah=(4+EffectiveComboPoints*4)*0.3;ai=S.Eviscerate:Damage()*V.Subtlety.EviscerateDMGOffset;if a9 then return a9 end;if ab>0 then ab=0 end;if aa>0 then aa=0 end;aa=R.ReturnSpell()ab=R.ReturnSpellMO()if m.GUISettings.General.OpenerReset>0 and not HeroRotationCharDB.Toggles[6]then I=GetTime()J=I+m.GUISettings.General.OpenerReset elseif m.GUISettings.General.OpenerReset>0 and J~=nil and GetTime()>J and HeroRotationCharDB.Toggles[6]then HeroRotationCharDB.Toggles[6]=not HeroRotationCharDB.Toggles[6]m.ToggleIconFrame:UpdateButtonText(6)m.Print("Opener is now "..(HeroRotationCharDB.Toggles[6]and"|cff00ff00enabled|r."or"|cffff0000disabled|r."))end;if m.QueuedCast()then aa=m.QueuedCast()return"Custom Queue "..i(aa):ID()end;if v and S.CheapShot:IsUsableP()and S.CheapShot:CooldownRemains()<=0 and g:StealthUp(true,true)and not g:PrevGCD(1,S.CheapShot)then if m.Cast(S.CheapShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.CheapShot)then ab=11833;return"queue Cheap Shot MO"else aa=1833;return"queue Cheap Shot"end end elseif(not S.CheapShot:IsUsableP()or S.CheapShot:CooldownRemains()>0 or g:PrevGCD(1,S.CheapShot))and v then HeroRotationCharDB.Toggles[22]=not HeroRotationCharDB.Toggles[22]m.Print("Cheap Shot Queue is now "..(HeroRotationCharDB.Toggles[22]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if w and S.KidneyShot:IsUsableP()and S.KidneyShot:CooldownRemains()<=0 then if m.Cast(S.KidneyShot,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.KidneyShot)then ab=1408;return"queue Kidney Shot MO"else aa=408;return"queue Kidney Shot"end end elseif g:PrevGCD(1,S.KidneyShot)and w then HeroRotationCharDB.Toggles[23]=not HeroRotationCharDB.Toggles[23]m.Print("Kidney Shot Queue is now "..(HeroRotationCharDB.Toggles[23]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if x and S.Blind:IsUsableP()and S.Blind:CooldownRemains()<=0 then if m.Cast(S.Blind,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Blind)then ab=12094;return"queue Blind MO"else aa=2094;return"queue Blind"end end elseif(not S.Blind:IsUsableP()or S.Blind:CooldownRemains()>0)and x then HeroRotationCharDB.Toggles[24]=not HeroRotationCharDB.Toggles[24]m.Print("Blind Queue is now "..(HeroRotationCharDB.Toggles[24]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if y and S.Sap:IsUsableP()and S.Sap:CooldownRemains()<=0 then if m.Cast(S.Sap,nil,nil,nil)then if f("mouseover"):GUID()~=nil and f("mouseover"):IsSpellInRange(S.Sap)then ab=16770;return"queue Sap MO"else aa=6770;return"queue Sap"end end elseif(not S.Sap:IsUsableP()or S.Sap:CooldownRemains()>0)and y then HeroRotationCharDB.Toggles[25]=not HeroRotationCharDB.Toggles[25]m.Print("Sap Queue is now "..(HeroRotationCharDB.Toggles[25]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if z and S.ShurikenTornado:IsUsableP()and S.ShurikenTornado:CooldownRemains()<=0 then if m.Cast(S.ShurikenTornado,nil,nil,nil)then aa=277925;return"queue Shuriken Tornado"end elseif(not S.ShurikenTornado:IsUsableP()or S.ShurikenTornado:CooldownRemains()>0)and z then HeroRotationCharDB.Toggles[26]=not HeroRotationCharDB.Toggles[26]m.Print("Shuriken Tornado Queue is now "..(HeroRotationCharDB.Toggles[26]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if A and S.Feint:IsUsableP()and S.Feint:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Feint,nil,nil,nil)then aa=202;return"queue Shuriken Tornado"end elseif(not S.Feint:IsUsableP()or S.Feint:CooldownRemains()>0 or not g:AffectingCombat())and A then HeroRotationCharDB.Toggles[27]=not HeroRotationCharDB.Toggles[27]m.Print("Feint Queue is now "..(HeroRotationCharDB.Toggles[27]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if B and S.Flagellation:IsUsableP()and S.Flagellation:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Flagellation,nil,nil,nil)then aa=323654;return"queue Flagellation Queue"end elseif(not S.Flagellation:IsUsableP()or S.Flagellation:CooldownRemains()>0 or not g:AffectingCombat())and B then HeroRotationCharDB.Toggles[28]=not HeroRotationCharDB.Toggles[28]m.Print("Flagellation Queue is now "..(HeroRotationCharDB.Toggles[28]and"|cff00ff00on|r."or"|cffff0000off|r."))end;if D then if S.ArcaneTorrent:IsAvailable()and S.ArcaneTorrent:IsUsableP()and S.ArcaneTorrent:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.ArcaneTorrent,nil,nil,nil)then aa=155145;return"queue ArcaneTorrent Queue"end elseif S.LightsJudgment:IsAvailable()and S.LightsJudgment:IsUsableP()and S.LightsJudgment:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.LightsJudgment,nil,nil,nil)then aa=255647;return"queue ArcaneTorrent Queue"end elseif S.BagofTricks:IsAvailable()and S.BagofTricks:IsUsableP()and S.BagofTricks:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BagofTricks,nil,nil,nil)then aa=312411;return"queue ArcaneTorrent Queue"end elseif S.BloodFury:IsAvailable()and S.BloodFury:IsUsableP()and S.BloodFury:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.BloodFury,nil,nil,nil)then aa=20572;return"queue ArcaneTorrent Queue"end elseif S.Berserking:IsAvailable()and S.Berserking:IsUsableP()and S.Berserking:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Berserking,nil,nil,nil)then aa=26297;return"queue ArcaneTorrent Queue"end elseif S.Fireblood:IsAvailable()and S.Fireblood:IsUsableP()and S.Fireblood:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.Fireblood,nil,nil,nil)then aa=265221;return"queue ArcaneTorrent Queue"end elseif S.AncestralCall:IsAvailable()and S.AncestralCall:IsUsableP()and S.AncestralCall:CooldownRemains()<=0 and g:AffectingCombat()then if m.Cast(S.AncestralCall,nil,nil,nil)then aa=274738;return"queue ArcaneTorrent Queue"end elseif(S.ArcaneTorrent:IsAvailable()and(not S.ArcaneTorrent:IsUsableP()or S.ArcaneTorrent:CooldownRemains()>0 or not g:AffectingCombat())or S.LightsJudgment:IsAvailable()and(not S.LightsJudgment:IsUsableP()or S.LightsJudgment:CooldownRemains()>0 or not g:AffectingCombat())or S.BagofTricks:IsAvailable()and(not S.BagofTricks:IsUsableP()or S.BagofTricks:CooldownRemains()>0 or not g:AffectingCombat())or S.BloodFury:IsAvailable()and(not S.BloodFury:IsUsableP()or S.BloodFury:CooldownRemains()>0 or not g:AffectingCombat())or S.Berserking:IsAvailable()and(not S.Berserking:IsUsableP()or S.Berserking:CooldownRemains()>0 or not g:AffectingCombat())or S.Fireblood:IsAvailable()and(not S.Fireblood:IsUsableP()or S.Fireblood:CooldownRemains()>0 or not g:AffectingCombat())or S.AncestralCall:IsAvailable()and(not S.AncestralCall:IsUsableP()or S.AncestralCall:CooldownRemains()>0 or not g:AffectingCombat()))and D then HeroRotationCharDB.Toggles[30]=not HeroRotationCharDB.Toggles[30]m.Print("Arcane Torrent Queue is now "..(HeroRotationCharDB.Toggles[30]and"|cff00ff00on|r."or"|cffff0000off|r."))end end;a9=R.CrimsonVial()if a9 then return a9 end;if g:AffectingCombat()and not g:IsDeadOrGhost()then a9=R.Feint()if a9 then return a9 end;a9=R.Evasion()if a9 then return a9 end;if g:HealthPercentage()<V.Commons.PhialHP and T.PhialofSerenity:IsReady()and T.PhialofSerenity:CooldownRemains()<=0 then if m.Cast(T.PhialofSerenity,nil)then aa=55;return"PhialofSerenity HP"end end;if g:HealthPercentage()<V.Commons.HealthstoneHP and T.Healthstone:IsReady()and T.Healthstone:CooldownRemains()<=0 then if m.Cast(T.Healthstone,nil)then aa=40;return"Healthstone HP"end end;if g:HealthPercentage()<V.Commons.HealPotHP and T.CosmicHealPot:IsReady()and T.CosmicHealPot:CooldownRemains()<=0 then if m.Cast(T.CosmicHealPot,nil)then aa=45;return"CosmicHealPot HP"end end;if g:HealthPercentage()<V.Commons.HealPotHP and T.HealPot:IsReady()and not T.CosmicHealPot:IsReady()and T.HealPot:CooldownRemains()<=0 then if m.Cast(T.HealPot,nil)then aa=41;return"HealPot HP"end end end;if UnitExists("mouseover")and string.find(UnitGUID("mouseover"),120651)then if S.Backstab:IsReady()and f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then ab=153;return"explosive MO SWD"end end;if S.ShurikenToss:IsReady()and f("mouseover"):IsInMeleeRange(40)and not f("mouseover"):IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then ab=1114014;return"explosive MO SWD"end end end;if UnitExists("target")and string.find(UnitGUID("target"),120651)then if S.Backstab:IsReady()and h:IsInMeleeRange(8)then if m.Cast(S.Backstab,nil)then aa=53;return"explosive  SWD"end end;if S.ShurikenToss:IsReady()and h:IsInMeleeRange(40)and not h:IsInMeleeRange(8)then if m.Cast(S.ShurikenToss,nil)then aa=114014;return"explosive MO SWD"end end end;H={324736,228318,178658,333227,334800,334967,324737,326450,334470,320703,320012,324085,333241,331510,344739,368477,368396,355057,356133,342139,353706,355782,327155,359668,321220,158337,382555}if UnitExists("target")and S.Shiv:IsReady()and not E then if UnitCanAttack("player","target")and UnitAffectingCombat("target")and UnitIsDead("target")~=true then for bs=0,40 do local aG,aG,bt,bu,aG,aG,aG,aG,aG,bv=UnitBuff("target",bs)for aG,bw in pairs(H)do if bw==bv then if m.Cast(S.Shiv,nil)then aa=5938;return"Shiv Enrage"end end end end end end;local bx=g:AffectingCombat()and 180 or 900;local by;if i(8679):IsAvailable()and V.Commons.LethalPoison=="Wound Poison"then by=g:BuffRemains(i(8679))if by<bx and not g:IsCasting(i(8679))then if m.Cast(i(8679))then aa=203;return"Wound Poison Refresh"end end elseif i(2823):IsAvailable()and V.Commons.LethalPoison=="Deadly Poison"then by=g:BuffRemains(i(2823))if by<bx and not g:IsCasting(i(2823))then if m.Cast(i(2823))then aa=208;return"Deadly Poison Refresh"end end elseif i(315584):IsAvailable()and V.Commons.LethalPoison=="Instant Poison"then by=g:BuffRemains(i(315584))if by<bx and not g:IsCasting(i(315584))then if m.Cast(i(315584))then aa=205;return"Instant Poison Refresh"end end end;if i(381637):IsAvailable()and V.Commons.NonLethalPoison=="Atrophic Poison"then by=g:BuffRemains(i(381637))if by<bx and not g:IsCasting(i(381637))then if m.Cast(i(381637))then aa=381637;return"Atropic Poison Refresh"end end elseif i(5761):IsAvailable()and V.Commons.NonLethalPoison=="Numbing Poison"then by=g:BuffRemains(i(5761))if by<bx and not g:IsCasting(NumbingPoison)then if m.Cast(i(5761))then aa=204;return"Numbing Poison Refresh"end end elseif i(3408):IsAvailable()and V.Commons.NonLethalPoison=="Crippling Poison"then by=g:BuffRemains(i(3408))if by<bx and not g:IsCasting(NumbingPoison)then if m.Cast(i(3408))then aa=206;return"Crippling Poison Refresh"end end end;if not g:AffectingCombat()and not g:IsDeadOrGhost()then if not g:BuffUp(S.ShadowDanceBuff)and not g:BuffUp(R.VanishBuffSpell())then a9=R.Stealth(R.StealthSpell())if a9 then return a9 end end;if Q.TargetIsValid()and(h:IsSpellInRange(S.Shadowstrike)or a7)and(not g:AffectingCombat()or q)then if m.CDsON()then if S.MarkedforDeath:IsCastable()and g:ComboPointsDeficit()>=R.CPMaxSpend()then if m.Cast(S.MarkedforDeath,nil)then aa=137619;return"Cast Marked for Death OOC"end end end;if g:StealthUp(true,true)and(g:AffectingCombat()or q)then a9=be()if a9 then return a9 .." (OOC)"end elseif am>=5 then if g:AffectingCombat()or q then a9=b6()if a9 then return a9 .." (OOC)"end end elseif S.Backstab:IsCastable()and(g:AffectingCombat()or q)then if m.Cast(S.Backstab)then aa=53;return"Cast Backstab (OOC)"end end end;return end;local bz;if not S.Vigor:IsAvailable()or S.Shadowcraft:IsAvailable()then bz=g:EnergyDeficitPredicted()<=aM()else bz=g:EnergyPredicted()>=aM()end;R.MfDSniping(S.MarkedforDeath)if Q.TargetIsValid()and(not h:DebuffUp(S.Sap)or(g:BuffUp(ag)or StealthSpell and StealthSpell:ID()==S.Vanish:ID()))then if a9 then return a9 end;a9=b2()if a9 then return"CDs: "..a9 end;local bA,bB,aG=GetSpellCooldown(57934)if V.Commons.AutoToT and g:AffectingCombat()then if bA+bB-GetTime()<=0 and S.TricksoftheTrade:IsAvailable()and S.TricksoftheTrade:CooldownRemains()<=0 and UnitExists("focus")and(UnitInParty("focus")or UnitInRaid("focus"))and IsItemInRange(32698,"focus")then if m.Cast(S.TricksoftheTrade)then aa=157934;return"ToT Focus"end end end;if bz or S.InvigoratingShadowdust:IsAvailable()and(g:AffectingCombat()or q)then a9=bm()if a9 then return"Stealth CDs: "..a9 end end;if EffectiveComboPoints>=R.CPMaxSpend()then a9=b6()if a9 then return"Finish: "..a9 end end;if an<=1 or d.BossFilteredFightRemains("<=",1)and EffectiveComboPoints>=3 then a9=b6()if a9 then return"Finish: "..a9 end end;if a3>=4 and EffectiveComboPoints>=4 then a9=b6()if a9 then return"Finish: "..a9 end end;a9=b0()if a9 then return"Build: "..a9 end;if m.CDsON()then if S.ArcaneTorrent:IsReady()and h:IsInMeleeRange(8)and V.Commons.Enabled.Racials and g:EnergyDeficitPredicted()>15+g:EnergyRegen()then if m.Cast(S.ArcaneTorrent,nil)then aa=155145;return"Cast Arcane Torrent"end end;if S.ArcanePulse:IsReady()and h:IsInMeleeRange(8)and V.Commons.Enabled.Racials then if m.Cast(S.ArcanePulse,nil)then aa=260364;return"Cast Arcane Pulse"end end;if S.LightsJudgment:IsReady()and h:IsInMeleeRange(8)and V.Commons.Enabled.Racials then if m.Cast(S.LightsJudgment,nil)then aa=255647;return"Cast Lights Judgment"end end;if S.BagofTricks:IsReady()and h:IsInMeleeRange(8)and V.Commons.Enabled.Racials then if m.Cast(S.BagofTricks,nil)then aa=312411;return"Cast Bag of Tricks"end end end end end;local function bC()if HeroRotationCharDB.Toggles[5]then HeroRotationCharDB.Toggles[5]=not HeroRotationCharDB.Toggles[5]m.ToggleIconFrame:UpdateButtonText(5)end;if HeroRotationCharDB.Toggles[171]then HeroRotationCharDB.Toggles[171]=not HeroRotationCharDB.Toggles[171]end;if HeroRotationCharDB.Toggles[172]then HeroRotationCharDB.Toggles[172]=not HeroRotationCharDB.Toggles[172]end;if HeroRotationCharDB.Toggles[29]then HeroRotationCharDB.Toggles[29]=not HeroRotationCharDB.Toggles[29]end end;function ReturnSpell()if aa==0 then return 0 else return aa end end;function ReturnSpellMO()if ab==0 then return 0 else return ab end end;m.SetAPL(261,bo,bC)